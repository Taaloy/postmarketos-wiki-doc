<!DOCTYPE html>
<html class="client-nojs" dir="ltr" lang="en">
 <head>
  <meta charset="utf-8"/>
  <title>
   Qualcomm Snapdragon 835 (MSM8998) - postmarketOS
  </title>
  <link href="../PostmarketOSWikiOffline.css" rel="stylesheet"/>
  <meta content="" name="ResourceLoaderDynamicStyles"/>
  <meta content="MediaWiki 1.34.2" name="generator"/>
  <link href="/favicon.ico" rel="shortcut icon"/>
  <link href="/opensearch_desc.php" rel="search" title="postmarketOS (en)" type="application/opensearchdescription+xml"/>
  <link href="https://wiki.postmarketos.org/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
  <link href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license"/>
  <link href="/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate" title="postmarketOS Atom feed" type="application/atom+xml"/>
 </head>
 <body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Qualcomm_Snapdragon_835_MSM8998 rootpage-Qualcomm_Snapdragon_835_MSM8998 skin-vector action-view">
  <div class="mw-body" id="content" role="main" style="margin: 0">
   <a id="top">
   </a>
   <div class="mw-indicators mw-body-content">
   </div>
   <h1 class="firstHeading" id="firstHeading" lang="en">
    Qualcomm Snapdragon 835 (MSM8998)
   </h1>
   <div class="mw-body-content" id="bodyContent">
    <div class="noprint" id="siteSub">
     From postmarketOS
    </div>
    <div id="contentSub">
    </div>
    <div id="jump-to-nav">
    </div>
    <a class="mw-jump-link" href="#mw-head">
     Jump to navigation
    </a>
    <a class="mw-jump-link" href="#p-search">
     Jump to search
    </a>
    <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
     <div class="mw-parser-output">
      <table cellspacing="3" class="infobox" style="border-spacing: 3px; width:22em;">
       <caption class="" style="">
        Qualcomm MSM8998
       </caption>
       <tbody>
        <tr class="">
         <td class="" colspan="2" style="text-align:center;">
          <a class="image" href="../Qualcomm_MSM8998.jpg">
           <img alt="MSM8998 in ceramic package" decoding="async" height="191" src="../Qualcomm_MSM8998.jpg" srcset="../" width="200"/>
          </a>
          <br/>
          <span style="">
           MSM8998 in ceramic package
          </span>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Manufacturer
         </th>
         <td class="" style="">
          Qualcomm
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Name
         </th>
         <td class="" style="">
          MSM8998
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Codenames
         </th>
         <td class="" style="">
          msmcobalt/apqcobalt
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Architecture
         </th>
         <td class="" style="">
          aarch64
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          CPU
         </th>
         <td class="" style="">
          4x 2.45 GHz Kryo 280 Gold, 4x 1.9 GHz Kryo 280 Silver
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          GPU
         </th>
         <td class="" style="">
          Adreno 540
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Year
         </th>
         <td class="" style="">
          2017
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Process
         </th>
         <td class="" style="">
          10nm
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Mainline
         </th>
         <td class="" style="">
          yes
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          <abbr title="A link to a git{hub,lab} organisation/repo where development happens">
           Community Page
          </abbr>
         </th>
         <td class="" style="">
          <a class="external free" href="https://gitlab.com/msm8998-mainline" rel="nofollow">
           https://gitlab.com/msm8998-mainline
          </a>
         </td>
        </tr>
        <tr>
         <th class="" colspan="2" style="text-align:center;">
          Components
         </th>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          <abbr title="SMP (bring up secondary CPU cores), CPU frequency scaling, CPUidle">
           CPU
          </abbr>
         </th>
         <td class="" style="">
          <div class="feature feature-partial">
           Partial
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          UART
         </th>
         <td class="" style="">
          <div>
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          <abbr title="eMMC, SD cards, UFS, ...">
           Storage
          </abbr>
         </th>
         <td class="" style="">
          <div class="feature feature-yes">
           Works
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          USB
         </th>
         <td class="" style="">
          <div class="feature feature-yes">
           Works
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Display
         </th>
         <td class="" style="">
          <div class="feature feature-partial">
           Partial
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          GPU
         </th>
         <td class="" style="">
          <div class="feature feature-no">
           Broken
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Pinctrl
         </th>
         <td class="" style="">
          <div class="feature feature-yes">
           Works
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          I²C
         </th>
         <td class="" style="">
          <div class="feature feature-yes">
           Works
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Audio
         </th>
         <td class="" style="">
          <div>
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          <abbr title="Hardware-accelerated video de/encoding">
           Video
          </abbr>
         </th>
         <td class="" style="">
          <div>
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Thermal
         </th>
         <td class="" style="">
          <div class="feature feature-yes">
           Works
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          WiFi
         </th>
         <td class="" style="">
          <div class="feature feature-yes">
           Works
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Bluetooth
         </th>
         <td class="" style="">
          <div class="feature feature-yes">
           Works
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          <abbr title="Calls, SMS, Internet">
           Modem
          </abbr>
         </th>
         <td class="" style="">
          <div class="feature feature-partial">
           Partial
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          GPS
         </th>
         <td class="" style="">
          <div class="feature feature-yes">
           Works
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Camera
         </th>
         <td class="" style="">
          <div>
          </div>
         </td>
        </tr>
        <tr class="">
         <th scope="row" style="text-align:left;">
          Suspend
         </th>
         <td class="" style="">
          <div>
          </div>
         </td>
        </tr>
        <tr>
         <td colspan="2" style="text-align:right">
         </td>
        </tr>
       </tbody>
      </table>
      <p>
       <br/>
      </p>
      <p>
       <a class="external text" href="https://www.qualcomm.com/products/snapdragon-835-mobile-platform" rel="nofollow">
        MSM8998
       </a>
       (or Snapdragon 835) is a high-end Qualcomm SoC released in 2017 with mainline support originally added for the
       <a class="external text" href="https://patchwork.kernel.org/cover/10586661/" rel="nofollow">
        MTP (proven reference design) board
       </a>
       towards the end of 2018.
      </p>
      <h2>
       <span class="mw-headline" id="Devices">
        Devices
       </span>
      </h2>
      <table class="cargoTable noMerge sortable" style="border-collapse: collapse;">
       <thead>
        <tr style="background-color: #eeeeee;">
         <th class="field_Device">
          Device
         </th>
         <th class="field_Codename">
          Codename
         </th>
         <th class="field_Mainline">
          Mainline
         </th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td class="field_Device">
          <a href="../en/Essential_Phone_(essential-mata).html" title="Essential Phone (essential-mata)">
           Essential Phone (PH1)
          </a>
         </td>
         <td class="field_Codename">
          essential-mata
         </td>
         <td class="feature">
          N
         </td>
        </tr>
        <tr style="background-color: #eeeeee;">
         <td class="field_Device">
          <a href="../en/F(x)tec_Pro1(x)_(fxtec-qx1000).html" title="F(x)tec Pro1(x) (fxtec-qx1000)">
           F(x)tec Pro1(X)
          </a>
         </td>
         <td class="field_Codename">
          fxtec-qx1000
         </td>
         <td class="feature feature-yes">
          Y
         </td>
        </tr>
        <tr>
         <td class="field_Device">
          <a href="../en/Google_Pixel_2_XL_(google-taimen).html" title="Google Pixel 2 XL (google-taimen)">
           Google Pixel 2 / XL
          </a>
         </td>
         <td class="field_Codename">
          google-walleye, google-taimen
         </td>
         <td class="feature feature-partial">
          P
         </td>
        </tr>
        <tr style="background-color: #eeeeee;">
         <td class="field_Device">
          <a href="../en/Motorola_Moto_Z2_Force_(motorola-nash).html" title="Motorola Moto Z2 Force (motorola-nash)">
           Motorola Moto Z2 Force
          </a>
         </td>
         <td class="field_Codename">
          motorola-nash
         </td>
         <td class="feature">
          N
         </td>
        </tr>
        <tr>
         <td class="field_Device">
          <a href="../en/OnePlus_5_(oneplus-cheeseburger).html" title="OnePlus 5 (oneplus-cheeseburger)">
           OnePlus 5
          </a>
         </td>
         <td class="field_Codename">
          oneplus-cheeseburger
         </td>
         <td class="feature feature-yes">
          Y
         </td>
        </tr>
        <tr style="background-color: #eeeeee;">
         <td class="field_Device">
          <a href="../en/OnePlus_5T_(oneplus-dumpling).html" title="OnePlus 5T (oneplus-dumpling)">
           OnePlus 5T
          </a>
         </td>
         <td class="field_Codename">
          oneplus-dumpling
         </td>
         <td class="feature feature-yes">
          Y
         </td>
        </tr>
        <tr>
         <td class="field_Device">
          <a href="../en/Xiaomi_Mi_6_(xiaomi-sagit).html" title="Xiaomi Mi 6 (xiaomi-sagit)">
           Xiaomi Mi 6
          </a>
         </td>
         <td class="field_Codename">
          xiaomi-sagit
         </td>
         <td class="feature feature-yes">
          Y
         </td>
        </tr>
       </tbody>
      </table>
      <h2>
       <span class="mw-headline" id="Booting">
        Booting
       </span>
      </h2>
      <p>
       Assuming you derived your board DTS from the MSM8998 MTP ones, you'll likely notice a built kernel doesn't actually boot without any changes. This has been
       <a class="external text" href="https://patchwork.kernel.org/project/linux-arm-msm/patch/20191003064449.2201-1-saiprakash.ranjan@codeaurora.org/" rel="nofollow">
        tracked down to CoreSight tracing activating
       </a>
       , which seems to cause kernel panics on retail hardware. As per the linked patch, simply delete the added
       <code>
        etf
       </code>
       ,
       <code>
        etm*
       </code>
       ,
       <code>
        etr
       </code>
       ,
       <code>
        funnel*
       </code>
       ,
       <code>
        replicator1
       </code>
       &amp;
       <code>
        stm
       </code>
       nodes from your DTS.
      </p>
      <p>
       Additionally enabling some options such as
       <code>
        CONFIG_MSM_GPUCC_8998
       </code>
       may still cause the kernel to panic anyway. To avoid disabling "unused clocks" during
       <code>
        late_initcall()
       </code>
       , append
       <code>
        clk_ignore_unused
       </code>
       to your cmdline which can be done via
       <a class="external text" href="https://github.com/ggrandou/abootimg" rel="nofollow">
        modifying the bootimg
       </a>
       ,
       <a class="external text" href="https://www.kernel.org/doc/Documentation/devicetree/usage-model.txt" rel="nofollow">
        bootargs on DTS
       </a>
       or
       <a class="external text" href="https://cateee.net/lkddb/web-lkddb/CMDLINE.html" rel="nofollow">
        setting CONFIG_CMDLINE in defconfig
       </a>
       .
      </p>
      <h2>
       <span class="mw-headline" id="Display">
        Display
       </span>
      </h2>
      <p>
       Support for displays is currently marked as partial since mainline MSM8998 is completely missing device tree bindings for the
       <a class="external text" href="https://lore.kernel.org/patchwork/patch/1151028/" rel="nofollow">
        MMCC
       </a>
       , MDSS, MDP5 &amp; DSI (as of 2020-11-16). However, unofficial patches for these
       <a class="external text" href="https://github.com/JamiKettunen/linux-mainline-oneplus5/commits/5ec1add02a6b1b617b90fc556b76a07db9cca3c4" rel="nofollow">
        are floating around
       </a>
       and they seem to be fully working (as tested on the OnePlus 5 with a Samsung S6E3FA5 DSI cmd mode panel on Linux 5.10)!
      </p>
      <p>
       For starters your best bet would be to setup
       <code>
        simplefb
       </code>
       though which utilizes the device framebuffer left active by the UEFI bootloader (Qualcomm XBL).
      </p>
      <table role="text container" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;">
       <tbody>
        <tr>
         <td style="padding: 2px 0 2px 0.9em; text-align: center;">
          <span style="white-space: nowrap;">
           <img alt="Note" decoding="async" height="20" src="../Reference_icon.svg" srcset="../Reference_icon.svg 1.5x ../Reference_icon.svg 2x" title="Note" width="20"/>
          </span>
         </td>
         <td style="padding: 0.35em 0.9em; width: 100%;">
          <b>
           NOTE:
          </b>
          Devices using DSC (Display Stream Compression) like the Pixel 2 XL will mostly likely not support simplefb!
         </td>
        </tr>
       </tbody>
      </table>
      <p>
       1. Enable
       <code>
        CONFIG_FB_SIMPLE
       </code>
       in your defconfig
      </p>
      <p>
       2. Apply a patch like this one to
       <b>
        your
       </b>
       board DTS while (as needed) replacing
       <code>
        1080
       </code>
       with the screen width and
       <code>
        1920
       </code>
       with the screen height (in pixels):
      </p>
      <div class="toccolours mw-collapsible mw-collapsed" style="width: 900px; overflow: auto;">
       <p>
        <code>
         $ cat msm8998-simplefb.patch
        </code>
       </p>
       <div class="mw-collapsible-content">
        <pre>--- a/arch/arm64/boot/dts/qcom/msm8998-oneplus-cheeseburger.dtsi
+++ b/arch/arm64/boot/dts/qcom/msm8998-oneplus-cheeseburger.dtsi
@@ -10,10 +10,36 @@
 	aliases {
 		serial0 = &amp;blsp2_uart1;
 		serial1 = &amp;blsp1_uart3;
+		display0 = &amp;framebuffer0;
 	};
 
 	chosen {
-		stdout-path = "serial0:115200n8";
+		#address-cells = &lt;2&gt;;
+		#size-cells = &lt;2&gt;;
+		ranges;
+
+		/* HACK: Use "display0" for simplefb; for UART console use "serial0:115200n8" instead */
+		stdout-path = "display0";
+
+		/*
+		 * Address and size extracted on-device using the following:
+		 * # strings /dev/block/bootdevice/by-name/xbl | grep 'Display Reserved'
+		 */
+		framebuffer0: framebuffer@9d400000 {
+			compatible = "simple-framebuffer";
+			reg = &lt;0 0x9d400000 0 0x2400000&gt;;
+			width = &lt;1080&gt;;
+			height = &lt;1920&gt;;
+			stride = &lt;(1080 * 4)&gt;;
+			format = "a8r8g8b8";
+		};
+	};
+
+	reserved-memory {
+		cont_splash_mem: memory@9d400000 {
+			reg = &lt;0 0x9d400000 0 0x2400000&gt;;
+			no-map;
+		};
 	};
 
 	vph_pwr: vph-pwr-regulator {
</pre>
       </div>
      </div>
      <h2>
       <span class="mw-headline" id="USB">
        USB
       </span>
      </h2>
      <p>
       Enabling USB on MSM8998 boards will differ between devices which use a USB 3.0 and USB 2.0 port.
      </p>
      <p>
       Needed modules on defconfig side should include the following (and even
       <code>
        QUSB2
       </code>
       can be dropped later if it turns out your device doesn't use this):
      </p>
      <pre>CONFIG_USB_CONFIGFS=y
CONFIG_PHY_QCOM_QMP=y
CONFIG_PHY_QCOM_QUSB2=y
</pre>
      <p>
       In general (and for USB 3.0 devices) the following in your DTS should be enough and you'll hopefully see the device detected on your host (assuming the kernel is configured with the needed modules):
      </p>
      <pre>&amp;usb3_dwc3 {
	dr_mode = "peripheral"; /* Force to peripheral until we have Type-C hooked up */
};
</pre>
      <p>
       For USB 2.0 devices utilizing the QUSB PHY however that alone isn't enough and you should
       <b>
        remove
       </b>
       the
       <code>
        usb3phy
       </code>
       node entirely from your DTS &amp; add the following configuration:
      </p>
      <div class="toccolours mw-collapsible mw-collapsed" style="width: 500px; overflow: auto;">
       <p>
        MSM8998 USB 2.0 configuration (DTS)
       </p>
       <div class="mw-collapsible-content">
        <pre>&amp;usb3 {
	/* Disable USB3 pipe_clk requirement */
	qcom,select-utmi-as-pipe-clk;
};

&amp;usb3_dwc3 {
	/* Drop the unused USB 3 SuperSpeed PHY */
	phys = &lt;&amp;qusb2phy&gt;;
	phy-names = "usb2-phy";

	/* We can only operate at USB 2.0 speeds */
	maximum-speed = "high-speed";
};
</pre>
       </div>
      </div>
      <p>
       In case you've adjusted the
       <code>
        l24
       </code>
       regulator minimum value below
       <code>
        3088000
       </code>
       μV to match downstream and USB doesn't work with no (obvious) issues on device
       <code>
        dmesg
       </code>
       , try setting it back to to this higher 3.08V value to see if it helps;
       <a class="external text" href="https://github.com/JamiKettunen/linux-mainline-oneplus5/commit/489b48b2aba961737a3c435c3333780c2f54050a" rel="nofollow">
        this was the case on the OnePlus 5
       </a>
       for example.
      </p>
      <h2>
       <span class="mw-headline" id="UFS_internal_storage">
        UFS internal storage
       </span>
      </h2>
      <table role="text container" style="color: inherit; background-color: #fee7e6; border: 1px solid #d33; margin: 4px 0; border-collapse: collapse;">
       <tbody>
        <tr>
         <td style="padding: 2px 0 2px 0.9em; text-align: center;">
          <span style="white-space: nowrap;">
           <img alt="Icon" decoding="async" height="20" src="../Red_warning_icon.svg" srcset="../Red_warning_icon.svg 1.5x ../Red_warning_icon.svg 2x" title="Icon" width="20"/>
           <br/>
           <b>
            Warning!
           </b>
          </span>
         </td>
         <td style="padding: 0.35em 0.9em; width: 100%;">
          IF YOUR DEVICE IS A SONY XPERIA DO NOT NEVER EVER EVER TRY TO ENABLE UFS ON NON-VENDOR/NON-SODP KERNELS! IT WILL ERASE THE CHIP CLEAN (INCLUDING THE BOOTLOADER!) CONSIDER YOURSELF WARNED
         </td>
        </tr>
       </tbody>
      </table>
      <p>
       To enable the device's internal UFS 2.1 host controller (and 14nm UFS QMP PHY), compile the kernel with the following modules enabled:
      </p>
      <pre>CONFIG_SCSI_UFS_QCOM=y
CONFIG_PHY_QCOM_QMP=y
</pre>
      <p>
       You can optionally set
       <code>
        CONFIG_SCSI_SCAN_ASYNC=y
       </code>
       for some additional speedup while booting. Consider also enabling
       <code>
        CONFIG_QFMT_V2
       </code>
       if you intend on writing data to a
       <code>
        userdata
       </code>
       partition formatted by Android where disk quotas are normally enabled by default for
       <code>
        ext4
       </code>
       volumes.
      </p>
      <h2>
       <span class="mw-headline" id="WLAN">
        WLAN
       </span>
      </h2>
      <p>
       For WLAN to work you need:
      </p>
      <p>
       1. On the kernel side:
      </p>
      <ul>
       <li>
        The MSS (modem) remoteproc needs to be running with firmware extracted from the device partitions
       </li>
       <li>
        DTS needs to point to the firmware filenames under
        <code>
         /lib/firmware/
        </code>
       </li>
       <li>
        Currently if you get FW details printed in dmesg from ath10k with nothing else seemingly happening, you'll most likely have to
        <a class="external text" href="https://github.com/JamiKettunen/linux-mainline-oneplus5/commit/088eaa9153803e2b028e092f88539036442da4a3" rel="nofollow">
         fake an MSA ready indication
        </a>
       </li>
      </ul>
      <p>
       2. On the userspace side:
      </p>
      <ul>
       <li>
        Follow steps from
        <a class="external text" href="https://github.com/jhugo/linux/blob/5.5rc2_wifi/README" rel="nofollow">
         jhugo's 5.5 MSM8998 Wi-Fi README
        </a>
        (it's not perfect but should work)
       </li>
       <li>
        Place all needed device firmware files to
        <code>
         /lib/firmware/
        </code>
       </li>
       <li>
        Make sure your OEM
        <code>
         wlanmdsp.mbn
        </code>
        is in the same directory with
        <code>
         modem.mdt
        </code>
        (or
        <code>
         modem.mbn
        </code>
        )!
       </li>
       <li>
        Install the following pmOS packages:
        <code>
         pd-mapper
        </code>
        ,
        <code>
         tqftpserv
        </code>
        ,
        <code>
         qrtr
        </code>
        &amp;
        <code>
         rmtfs
        </code>
       </li>
       <li>
        Enable the services (
        <code>
         rc-update add SERVICE_NAME boot
        </code>
        ) for all of the above except
        <code>
         qrtr
        </code>
        (it's started automatically if needed)
       </li>
       <li>
        Run
        <code>
         diag-router
        </code>
        from
        <a class="external free" href="https://github.com/andersson/diag" rel="nofollow">
         https://github.com/andersson/diag
        </a>
        in case MSS remoteproc keeps crashing and networks can be seen in e.g.
        <code>
         nmtui
        </code>
        soon after booting
       </li>
      </ul>
      <p>
       <br/>
      </p>
      <table role="text container" style="color: inherit; background-color: #CCD7E8; border: 2px dotted #98A9C1; margin: 4px 10%; border-collapse: collapse;">
       <tbody>
        <tr>
         <td style="padding: 2px 0 2px 0.9em; text-align: center;">
          <span style="white-space: nowrap;">
           <img alt="Icon" decoding="async" height="28" src="../Circle_icon_crossroads.png" srcset="../Circle_icon_crossroads.png 1.5x ../Circle_icon_crossroads.png 2x" title="Icon" width="28"/>
          </span>
         </td>
         <td style="padding: 0.35em 0.9em; width: 100%;">
          <b>
           This page could use some expansion.
          </b>
          If you'd like to help out, feel free to
          <span class="plainlinks">
           <a class="external text" href="https://wiki.postmarketos.org/index.php?title=Qualcomm_Snapdragon_835_(MSM8998)&amp;action=edit" rel="nofollow">
            edit this article
           </a>
          </span>
          !
          <br/>
          In particular:
          <i>
           The WLAN notes are just a rough sketch
          </i>
         </td>
        </tr>
       </tbody>
      </table>
      <h3>
       <span class="mw-headline" id="iwd">
        iwd
       </span>
      </h3>
      <p>
       By default iwd (on the OnePlus 5 at least) has an issue where it will refuse to connect, apparently related to
       <code>
        EAPoL
       </code>
       .
This can be worked around by adding the following to
       <code>
        /etc/iwd/main.conf
       </code>
       (create the file if it doesn't exist).
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="k">[General]</span>
<span class="na">ControlPortOverNL80211</span><span class="o">=</span><span class="s">false</span>
</pre>
      </div>
      <p>
       "
       <i>
        the EAPoL handshake is performed but we keep receiving packet 3/4 again and again on a 1 second interval. The replay key counter is never being increased so iwd just droped the packet and after a while the AP gives up
       </i>
       "
      </p>
      <p>
       The suggestion is either a wifi firmware bug, the driver not supporting nl80211 properly or an issue with the access point.
      </p>
      <h2>
       <span class="mw-headline" id="Bluetooth">
        Bluetooth
       </span>
      </h2>
      <p>
       Getting Bluetooth to work should be trivial assuming you compile the kernel with the following modules enabled:
      </p>
      <pre>CONFIG_RFKILL=m
CONFIG_BT_RFCOMM=y
CONFIG_BT_BNEP=y
CONFIG_BT_HIDP=y
CONFIG_BT_HS=y
CONFIG_BT_LE=y
</pre>
      <p>
       After those are set and you've copied the needed kernel modules over to the rootfs in
       <code>
        /lib/modules/
       </code>
       you just need the following firmware files in
       <code>
        /lib/firmware/qca/
       </code>
       :
      </p>
      <pre>crbtfw21.tlv
crnv21.bin
</pre>
      <p>
       Those can be supplied directly from
       <code>
        <a class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/tree/qca" rel="nofollow">
         linux-firmware
        </a>
       </code>
       and they should work fine, but if not you'll need to grab the files from your device's firmware partitions.
      </p>
      <h2>
       <span class="mw-headline" id="GPS">
        GPS
       </span>
      </h2>
      <p>
       GPS should "just work" when the modem is up. You should check whether the Position Determination Service (PDS) is running using
       <code>
        qrtr-lookup
       </code>
       :
      </p>
      <pre> $ qrtr-lookup | grep PDS
        16       2        0    0    83 Location service (~ PDS v2)
</pre>
      <p>
       After this you can essentially install
       <a class="external text" href="https://gitlab.com/gpsd/gpsd/-/merge_requests/139" rel="nofollow">
        GPSD with the Qualcomm PDS patch
       </a>
       , configure it to use
       <code>
        pds://any
       </code>
       as the device during runtime and you should be good to go.
      </p>
      <h2>
       <span id="Real-time_clock_(RTC)">
       </span>
       <span class="mw-headline" id="Real-time_clock_.28RTC.29">
        Real-time clock (RTC)
       </span>
      </h2>
      <p>
       The RTC module found on the PM8998 PMIC block works with
       <code>
        CONFIG_RTC_DRV_PM8XXX
       </code>
       enabled. It can be easily tested from userspace like so:
      </p>
      <pre># cd /sys/class/rtc/rtc0/
# echo $((`cat since_epoch`+120)) &gt; wakealarm
</pre>
      <p>
       After running that and fully powering down the device it should power on by itself soon afterwards (2 minutes later to be exact).
      </p>
      <h2>
       <span class="mw-headline" id="Haptics">
        Haptics
       </span>
      </h2>
      <p>
       Haptics are supported, see
       <a href="../en/Haptics.html" title="Haptics">
        Haptics
       </a>
       for more details.
      </p>
      <h2>
       <span class="mw-headline" id="See_also">
        See also
       </span>
      </h2>
      <p>
       <a class="external text" href="https://github.com/JamiKettunen/linux-mainline-oneplus5" rel="nofollow">
        linux-mainline-oneplus5
       </a>
       A mainline kernel fork with some patches for MSM8998 and OnePlus 5/5T support (check the
       <a class="external text" href="https://github.com/JamiKettunen/linux-mainline-oneplus5/commits/linux-5.7" rel="nofollow">
        5.7 branch commits
       </a>
       for a "step-by-step guide")
      </p>
      <p>
       <a href="../en/OnePlus_5_(oneplus-cheeseburger).html#Mainline_kernel" title="OnePlus 5 (oneplus-cheeseburger)">
        OnePlus_5_(oneplus-cheeseburger)#Mainline_kernel
       </a>
      </p>
      <h2>
       <span id="Who's_working_on_it">
       </span>
       <span class="mw-headline" id="Who.27s_working_on_it">
        Who's working on it
       </span>
      </h2>
      <ul>
       <li>
        <a href="../User:Deathmist.html" title="User:Deathmist">
         User:Deathmist
        </a>
        (@deathmist on Matrix)
       </li>
       <li>
        <a class="new" href="/index.php?title=User:R0551&amp;action=edit&amp;redlink=1" title="User:R0551 (page does not exist)">
         User:R0551
        </a>
        (@r0551 on Matrix)
       </li>
       <li>
        <a href="../User:Degdag.html" title="User:Degdag">
         User:Degdag
        </a>
        (@degdag on Matrix) [working on Xiaomi Mi 6]
       </li>
       <li>
        <a href="../User:Kalube.html" title="User:Kalube">
         User:kalube
        </a>
        (@caleb on Matrix) [working on Pixel 2 XL]
       </li>
       <li>
        <a class="external text" href="https://github.com/SoMainline/" rel="nofollow">
         SoMainline
        </a>
        [working on F(x)tec Pro1 &amp; SoMC Yoshino]
       </li>
      </ul>
      <p>
       (feel free to add yourself here if you're working on MSM8998 mainlining!)
      </p>
     </div>
    </div>
    <div class="catlinks" data-mw="interface" id="catlinks">
     <div class="mw-normal-catlinks" id="mw-normal-catlinks">
      <a href="../Special:Categories.html" title="Special:Categories">
       Categories
      </a>
      :
      <ul>
       <li>
        <a href="../en/Category:Socs.html" title="Category:Socs">
         Socs
        </a>
       </li>
       <li>
        <a href="../en/Category:Stubs.html" title="Category:Stubs">
         Stubs
        </a>
       </li>
      </ul>
     </div>
    </div>
    <div class="visualClear">
    </div>
   </div>
  </div>
  <div id="footer" role="contentinfo" style="margin: 0">
   <ul id="footer-info">
    <li>
     Retrieved from "
     <a dir="ltr" href="https://wiki.postmarketos.org/index.php?title=Qualcomm_Snapdragon_835_(MSM8998)&amp;oldid=27956">
      https://wiki.postmarketos.org/index.php?title=Qualcomm_Snapdragon_835_(MSM8998)&amp;oldid=27956
     </a>
     "
    </li>
    <li id="footer-info-lastmod">
     This page was last edited on 24 May 2022, at 11:42.
    </li>
    <li id="footer-info-copyright">
     Content is available under
     <a class="external" href="https://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow">
      Creative Commons Attribution-ShareAlike
     </a>
     unless otherwise noted.
    </li>
    <br/>
   </ul>
   <ul id="footer-places">
    <li id="footer-places-privacy">
     <a href="../en/PostmarketOS:Privacy_policy.html" title="PostmarketOS:Privacy policy">
      Privacy policy
     </a>
    </li>
    <li id="footer-places-about">
     <a class="mw-redirect" href="../en/About_postmarketOS.html" title="PostmarketOS:About">
      About postmarketOS
     </a>
    </li>
    <li id="footer-places-disclaimer">
     <a href="../en/PostmarketOS:General_disclaimer.html" title="PostmarketOS:General disclaimer">
      Disclaimers
     </a>
    </li>
    <li id="footer-places-mobileview">
     <a class="noprint stopMobileRedirectToggle" href="https://wiki.postmarketos.org/index.php?title=Qualcomm_Snapdragon_835_(MSM8998)&amp;mobileaction=toggle_view_mobile">
      Mobile view
     </a>
    </li>
   </ul>
   <ul class="noprint" id="footer-icons">
    <li id="footer-copyrightico">
     <a href="https://creativecommons.org/licenses/by-sa/4.0/">
      <img alt="Creative Commons Attribution-ShareAlike" height="31" src="../cc-by-sa.png" width="88"/>
     </a>
    </li>
    <li id="footer-poweredbyico">
     <a href="https://www.mediawiki.org/">
      <img alt="Powered by MediaWiki" height="31" src="../poweredby_mediawiki_88x31.png" srcset="" width="88"/>
     </a>
    </li>
   </ul>
   <div style="clear: both;">
   </div>
  </div>
 </body>
</html>
