<!DOCTYPE html>
<html class="client-nojs" dir="ltr" lang="en">
 <head>
  <meta charset="utf-8"/>
  <title>
   SSH - postmarketOS
  </title>
  <link href="../PostmarketOSWikiOffline.css" rel="stylesheet"/>
  <meta content="" name="ResourceLoaderDynamicStyles"/>
  <meta content="MediaWiki 1.34.2" name="generator"/>
  <link href="/favicon.ico" rel="shortcut icon"/>
  <link href="/opensearch_desc.php" rel="search" title="postmarketOS (en)" type="application/opensearchdescription+xml"/>
  <link href="https://wiki.postmarketos.org/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
  <link href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license"/>
  <link href="/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate" title="postmarketOS Atom feed" type="application/atom+xml"/>
 </head>
 <body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-SSH rootpage-SSH skin-vector action-view">
  <div class="mw-body" id="content" role="main" style="margin: 0">
   <a id="top">
   </a>
   <div class="mw-indicators mw-body-content">
   </div>
   <h1 class="firstHeading" id="firstHeading" lang="en">
    SSH
   </h1>
   <div class="mw-body-content" id="bodyContent">
    <div class="noprint" id="siteSub">
     From postmarketOS
    </div>
    <div id="contentSub">
    </div>
    <div id="jump-to-nav">
    </div>
    <a class="mw-jump-link" href="#mw-head">
     Jump to navigation
    </a>
    <a class="mw-jump-link" href="#p-search">
     Jump to search
    </a>
    <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
     <div class="mw-parser-output">
      <p>
       This article provides an overview of how to use the
       <a class="external text" href="https://en.wikipedia.org/wiki/Secure_Shell" rel="nofollow">
        SSH server
       </a>
       after postmarketOS was installed. It is aimed at beginners, who have possibly installed postmarketOS for the first time through the
       <a href="../en/On-device_installer.html" title="On-device installer">
        on-device installer
       </a>
       or
       <a href="../en/Pmbootstrap.html" title="Pmbootstrap">
        pmbootstrap
       </a>
       .
      </p>
      <div class="toc" id="toc">
       <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/>
       <div class="toctitle" dir="ltr" lang="en">
        <h2>
         Contents
        </h2>
        <span class="toctogglespan">
         <label class="toctogglelabel" for="toctogglecheckbox">
         </label>
        </span>
       </div>
       <ul>
        <li class="toclevel-1 tocsection-1">
         <a href="#Start_the_SSH_Daemon">
          <span class="tocnumber">
           1
          </span>
          <span class="toctext">
           Start the SSH Daemon
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-2">
         <a href="#Find_the_IP_of_your_phone">
          <span class="tocnumber">
           2
          </span>
          <span class="toctext">
           Find the IP of your phone
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-3">
           <a href="#Wi-Fi">
            <span class="tocnumber">
             2.1
            </span>
            <span class="toctext">
             Wi-Fi
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-4">
         <a href="#First_login">
          <span class="tocnumber">
           3
          </span>
          <span class="toctext">
           First login
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-5">
         <a href="#Hardening">
          <span class="tocnumber">
           4
          </span>
          <span class="toctext">
           Hardening
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-6">
           <a href="#Replace_password_with_SSH_key">
            <span class="tocnumber">
             4.1
            </span>
            <span class="toctext">
             Replace password with SSH key
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-7">
           <a href="#Enable_specific_network_interfaces_only">
            <span class="tocnumber">
             4.2
            </span>
            <span class="toctext">
             Enable specific network interfaces only
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-8">
         <a href="#Troubleshooting">
          <span class="tocnumber">
           5
          </span>
          <span class="toctext">
           Troubleshooting
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-9">
           <a href="#Login_with_username_.22user.22_fails">
            <span class="tocnumber">
             5.1
            </span>
            <span class="toctext">
             Login with username "user" fails
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-10">
         <a href="#Cool_things_to_do_with_SSH">
          <span class="tocnumber">
           6
          </span>
          <span class="toctext">
           Cool things to do with SSH
          </span>
         </a>
        </li>
       </ul>
      </div>
      <h3>
       <span class="mw-headline" id="Start_the_SSH_Daemon">
        Start the SSH Daemon
       </span>
      </h3>
      <p>
       If you are running postmarketOS from a pre-built image, the SSH daemon is disabled. Open a terminal on your phone and type the following to start it. Your sudo password is your PIN (
       <code>
        147147
       </code>
       in pre-built images):
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> sudo service sshd start
</pre>
      </div>
      <p>
       Enable the service on every boot:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> sudo rc-update add sshd
</pre>
      </div>
      <p>
       Note that in SXMO, you can type the minus (
       <code>
        -
       </code>
       ) character after long-pressing the dot (
       <code>
        .
       </code>
       ).
      </p>
      <h3>
       <span class="mw-headline" id="Find_the_IP_of_your_phone">
        Find the IP of your phone
       </span>
      </h3>
      <p>
       When connecting your phone via
       <a href="../en/USB_Network.html" title="USB Network">
        USB Network
       </a>
       , then the IP of the phone is
       <code>
        172.16.42.1
       </code>
       .
      </p>
      <h4>
       <span class="mw-headline" id="Wi-Fi">
        Wi-Fi
       </span>
      </h4>
      <p>
       In
       <a href="../en/Phosh.html" title="Phosh">
        Phosh
       </a>
       , you can find the IP in the "Settings" app, by clicking on the cogwheel next to the Wi-Fi network you are connected to, then "More details".
      </p>
      <p>
       In any user interface, you can open a terminal and type
       <code>
        ip a
       </code>
       to display the Wi-Fi IP.
      </p>
      <h3>
       <span class="mw-headline" id="First_login">
        First login
       </span>
      </h3>
      <table role="text container" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;">
       <tbody>
        <tr>
         <td style="padding: 2px 0 2px 0.9em; text-align: center;">
          <span style="white-space: nowrap;">
           <img alt="Note" decoding="async" height="20" src="../Reference_icon.svg" srcset="../Reference_icon.svg 1.5x ../Reference_icon.svg 2x" title="Note" width="20"/>
          </span>
         </td>
         <td style="padding: 0.35em 0.9em; width: 100%;">
          Password authentication with a short password is unsafe! Leave it in this state not longer than necessary by following
          <a href="#Replace_password_with_SSH_key">
           replace password with SSH key
          </a>
          below.
         </td>
        </tr>
       </tbody>
      </table>
      <p>
       Make sure your phone is on the same Wi-Fi network as your PC, or connect your phone via USB to your PC. Then type:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> ssh username@172.16.42.1
</pre>
      </div>
      <p>
       In pre-built images, username defaults to
       <code>
        user
       </code>
       and your user's password or PIN is
       <code>
        147147
       </code>
       . Adjust the IP as necessary.
      </p>
      <p>
       If you cannot login as
       <code>
        user
       </code>
       , see the troubleshooting instructions below.
      </p>
      <p>
       If that doesn't help it either, see
       <a href="../en/USB_Network.html" title="USB Network">
        USB Network
       </a>
       for a more detailed guide and more troubleshooting instructions.
      </p>
      <h3>
       <span class="mw-headline" id="Hardening">
        Hardening
       </span>
      </h3>
      <h4>
       <span class="mw-headline" id="Replace_password_with_SSH_key">
        Replace password with SSH key
       </span>
      </h4>
      <p>
       If the SSH server is enabled in postmarketOS (in the on-device installer, one can decide at install-time), it listens to USB networking, Wi-Fi and cellular network. This provides a big attack surface, so it's highly recommended to install an SSH key and disable password login.
      </p>
      <p>
       In order to do so, you need to generate a keypair on your client machine. If that is still connected to the phone, quit the connection:
       <code>
        $ exit
       </code>
       . Then generate the keypair:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> ssh-keygen -t rsa
</pre>
      </div>
      <p>
       Now you will be asked a few questions. You can hit 'Enter' to chose the default location for the keys. Set a passphrase you can remember. After the successful generation of the keys, the public key is now located in /home/user/.ssh/id_rsa.pub. The public key needs to be transferred to the phone.
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> ssh-copy-id username@172.16.42.1
</pre>
      </div>
      <p>
       You will have to enter your phones password. Now make sure everything worked by using ssh with your passphrase:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> ssh username@172.16.42.1
</pre>
      </div>
      <p>
       If you were asked for the passphrase and successfully logged in, everything worked as expected. The next step is to only allow logging in via the ssh keys. To do so, edit the file /etc/ssh/sshd_config. If you have nano installed the command is:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> sudo nano /etc/ssh/sshd_config
</pre>
      </div>
      <p>
       In this file, set:
      </p>
      <pre>PasswordAuthentication no
</pre>
      <p>
       Save and close the file. You might have to restart the ssh server for the changes to take effect.
      </p>
      <h4>
       <span class="mw-headline" id="Enable_specific_network_interfaces_only">
        Enable specific network interfaces only
       </span>
      </h4>
      <p>
       New installations have a
       <code>
        nftables
       </code>
       as
       <a href="../en/Firewall.html" title="Firewall">
        firewall
       </a>
       configured that limits incoming SSH connections to Wi-Fi and USB. As mentioned in the linked article, you can add your own rules too if you want to lock it down even more.
      </p>
      <h3>
       <span class="mw-headline" id="Troubleshooting">
        Troubleshooting
       </span>
      </h3>
      <h4>
       <span id='Login_with_username_"user"_fails'>
       </span>
       <span class="mw-headline" id="Login_with_username_.22user.22_fails">
        Login with username "user" fails
       </span>
      </h4>
      <p>
       In postmarketOS v21.03 and earlier, as well as postmarketOS edge before 2021-06, the on-device installer asked if a dedicated SSH user should be created. While the original idea was to ensure that the SSH user always has a stronger password than just a numeric PIN that would be used for the main user at the time, this made the installation process more complicated and it's more complex to use the dedicated user to access files from / start applications for the regular user. So this was removed in favor of having SSH always disabled and following the (relatively simple) steps to enable and secure it on this wiki page. So if you are currently running a postmarketOS installation that was set up like this, do the following to make it possible to login as the regular user. And then make sure that you copy over your SSH key and disable password authentication again, as described above in this article.
      </p>
      <p>
       Open the file
       <code>
        /etc/ssh/sshd_config
       </code>
       with a text editor, for example
       <code>
        vi
       </code>
       :
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> sudo vi /etc/ssh/sshd_config
</pre>
      </div>
      <p>
       Then enable password authentication for your user by removing the following section from the end of the file (in
       <code>
        vi
       </code>
       : arrow keys or
       <code>
        j
       </code>
       /
       <code>
        k
       </code>
       to navigate up/down, press
       <code>
        d
       </code>
       twice to delete a line,
       <code>
        :w
       </code>
       to write,
       <code>
        :q
       </code>
       to quit).
      </p>
      <pre>Match User user
    PasswordAuthentication no
Match all</pre>
      <p>
       Save and close the file and restart (or start if not running) the SSH service:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> sudo service sshd restart
</pre>
      </div>
      <h3>
       <span class="mw-headline" id="Cool_things_to_do_with_SSH">
        Cool things to do with SSH
       </span>
      </h3>
      <ul>
       <li>
        <a href="../en/USB_Internet.html" title="USB Internet">
         Share your PC's Internet with the phone
        </a>
       </li>
       <li>
        Backup and restore your data, as explained in
        <a class="mw-redirect" href="../en/Upgrade_to_a_newer_postmarketOS_release.html" title="Upgrade release">
         upgrade release
        </a>
       </li>
       <li>
        <a href="../User:Jtagcat_Automatically_retrieve_phone's_IP_to_SSH_in_to_with_syncthing.html" title="User:Jtagcat/Automatically retrieve phone's IP to SSH in to with syncthing">
         Store IP in syncthing
        </a>
       </li>
      </ul>
     </div>
    </div>
    <div class="catlinks" data-mw="interface" id="catlinks">
     <div class="mw-normal-catlinks" id="mw-normal-catlinks">
      <a href="../Special:Categories.html" title="Special:Categories">
       Category
      </a>
      :
      <ul>
       <li>
        <a href="../en/Category:Guide.html" title="Category:Guide">
         Guide
        </a>
       </li>
      </ul>
     </div>
    </div>
    <div class="visualClear">
    </div>
   </div>
  </div>
  <div id="footer" role="contentinfo" style="margin: 0">
   <ul id="footer-info">
    <li>
     Retrieved from "
     <a dir="ltr" href="https://wiki.postmarketos.org/index.php?title=SSH&amp;oldid=28357">
      https://wiki.postmarketos.org/index.php?title=SSH&amp;oldid=28357
     </a>
     "
    </li>
    <li id="footer-info-lastmod">
     This page was last edited on 6 June 2022, at 09:38.
    </li>
    <li id="footer-info-copyright">
     Content is available under
     <a class="external" href="https://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow">
      Creative Commons Attribution-ShareAlike
     </a>
     unless otherwise noted.
    </li>
    <br/>
   </ul>
   <ul id="footer-places">
    <li id="footer-places-privacy">
     <a href="../en/PostmarketOS:Privacy_policy.html" title="PostmarketOS:Privacy policy">
      Privacy policy
     </a>
    </li>
    <li id="footer-places-about">
     <a class="mw-redirect" href="../en/About_postmarketOS.html" title="PostmarketOS:About">
      About postmarketOS
     </a>
    </li>
    <li id="footer-places-disclaimer">
     <a href="../en/PostmarketOS:General_disclaimer.html" title="PostmarketOS:General disclaimer">
      Disclaimers
     </a>
    </li>
    <li id="footer-places-mobileview">
     <a class="noprint stopMobileRedirectToggle" href="https://wiki.postmarketos.org/index.php?title=SSH&amp;mobileaction=toggle_view_mobile">
      Mobile view
     </a>
    </li>
   </ul>
   <ul class="noprint" id="footer-icons">
    <li id="footer-copyrightico">
     <a href="https://creativecommons.org/licenses/by-sa/4.0/">
      <img alt="Creative Commons Attribution-ShareAlike" height="31" src="../cc-by-sa.png" width="88"/>
     </a>
    </li>
    <li id="footer-poweredbyico">
     <a href="https://www.mediawiki.org/">
      <img alt="Powered by MediaWiki" height="31" src="../poweredby_mediawiki_88x31.png" srcset="" width="88"/>
     </a>
    </li>
   </ul>
   <div style="clear: both;">
   </div>
  </div>
 </body>
</html>
