<!DOCTYPE html>
<html class="client-nojs" dir="ltr" lang="en">
 <head>
  <meta charset="utf-8"/>
  <title>
   Charging-sdl - postmarketOS
  </title>
  <link href="../PostmarketOSWikiOffline.css" rel="stylesheet"/>
  <meta content="" name="ResourceLoaderDynamicStyles"/>
  <meta content="MediaWiki 1.34.2" name="generator"/>
  <link href="/favicon.ico" rel="shortcut icon"/>
  <link href="/opensearch_desc.php" rel="search" title="postmarketOS (en)" type="application/opensearchdescription+xml"/>
  <link href="https://wiki.postmarketos.org/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
  <link href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license"/>
  <link href="/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate" title="postmarketOS Atom feed" type="application/atom+xml"/>
 </head>
 <body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Charging-sdl rootpage-Charging-sdl skin-vector action-view">
  <div class="mw-body" id="content" role="main" style="margin: 0">
   <a id="top">
   </a>
   <div class="mw-indicators mw-body-content">
   </div>
   <h1 class="firstHeading" id="firstHeading" lang="en">
    Charging-sdl
   </h1>
   <div class="mw-body-content" id="bodyContent">
    <div class="noprint" id="siteSub">
     From postmarketOS
    </div>
    <div id="contentSub">
    </div>
    <div id="jump-to-nav">
    </div>
    <a class="mw-jump-link" href="#mw-head">
     Jump to navigation
    </a>
    <a class="mw-jump-link" href="#p-search">
     Jump to search
    </a>
    <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
     <div class="mw-parser-output">
      <table role="text container" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;">
       <tbody>
        <tr>
         <td style="padding: 2px 0 2px 0.9em; text-align: center;">
          <span style="white-space: nowrap;">
           <img alt="Note" decoding="async" height="20" src="../Reference_icon.svg" srcset="../Reference_icon.svg 1.5x ../Reference_icon.svg 2x" title="Note" width="20"/>
          </span>
         </td>
         <td style="padding: 0.35em 0.9em; width: 100%;">
          Currently charging-sdl is disabled by default, see
          <a class="external text" href="https://gitlab.com/postmarketOS/pmaports/-/issues/1064" rel="nofollow">
           pmaports#1064
          </a>
          .
         </td>
        </tr>
       </tbody>
      </table>
      <p>
       This is an application developed by the postmarketOS community to display the charging status when the device is powered on in "charge mode".
      </p>
      <p>
       It is written in C and uses SDL2/SDL_power to query the battery information. The
       <span class="plainlinks" style="font-family: monospace, Courier;font-size:10pt;">
        <a class="external text" href="http://pkgs.postmarketos.org/packages?name=charging-sdl" rel="nofollow">
         charging-sdl
         <sup>
          PMOS
         </sup>
        </a>
       </span>
       package is part of postmarketOS's aports.
      </p>
      <div class="toc" id="toc">
       <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/>
       <div class="toctitle" dir="ltr" lang="en">
        <h2>
         Contents
        </h2>
        <span class="toctogglespan">
         <label class="toctogglelabel" for="toctogglecheckbox">
         </label>
        </span>
       </div>
       <ul>
        <li class="toclevel-1 tocsection-1">
         <a href="#Reporting_issues">
          <span class="tocnumber">
           1
          </span>
          <span class="toctext">
           Reporting issues
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-2">
         <a href="#Current_implementation">
          <span class="tocnumber">
           2
          </span>
          <span class="toctext">
           Current implementation
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-3">
         <a href="#Run_charging-sdl_manually">
          <span class="tocnumber">
           3
          </span>
          <span class="toctext">
           Run charging-sdl manually
          </span>
         </a>
        </li>
        <li class="toclevel-1 tocsection-4">
         <a href="#Troubleshooting">
          <span class="tocnumber">
           4
          </span>
          <span class="toctext">
           Troubleshooting
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-5">
           <a href="#Charge_mode_not_detected">
            <span class="tocnumber">
             4.1
            </span>
            <span class="toctext">
             Charge mode not detected
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-6">
           <a href="#DirectFB.2FFBDev:_No_supported_modes_found_in_.2Fetc.2Ffb.modes_and_current_mode_not_supported.21">
            <span class="tocnumber">
             4.2
            </span>
            <span class="toctext">
             DirectFB/FBDev: No supported modes found in /etc/fb.modes and current mode not supported!
            </span>
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </div>
      <h2>
       <span class="mw-headline" id="Reporting_issues">
        Reporting issues
       </span>
      </h2>
      <p>
       Issues with
       <code>
        charging-sdl
       </code>
       should be reported on
       <a class="external text" href="https://gitlab.com/postmarketOS/charging-sdl/issues" rel="nofollow">
        the project GitLab issues page
       </a>
       .
      </p>
      <h2>
       <span class="mw-headline" id="Current_implementation">
        Current implementation
       </span>
      </h2>
      <p>
       Connecting the usb cable to the phone while it's powered off should start the device as usual and in the initramfs it should detect that it's started in "charge mode", showing the
       <code>
        charging-sdl
       </code>
       for 5 seconds.
      </p>
      <p>
       You can show this
       <code>
        charging-sdl
       </code>
       screen again for another 5 seconds by pressing the power key.
      </p>
      <p>
       <code>
        charging-sdl
       </code>
       will show a lightning icon in the top left of the screen when the battery is charging, and if you unplug it the icon should disappear.
      </p>
      <h2>
       <span class="mw-headline" id="Run_charging-sdl_manually">
        Run charging-sdl manually
       </span>
      </h2>
      <p>
       You first have to boot the device into the
       <code>
        debug-shell
       </code>
       . (See
       <a href="../en/Inspecting_the_initramfs.html" title="Inspecting the initramfs">
        Inspecting the initramfs
       </a>
       )
      </p>
      <p>
       After you connected to the device using telnet, you can run:
      </p>
      <div class="mw-highlight mw-content-ltr" dir="ltr">
       <pre><span></span><span class="gp">$</span> <span class="nb">source</span> /init_functions.sh
<span class="gp">$</span> mount_boot_partition /boot
<span class="gp">$</span> extract_initramfs_extra /boot/*-extra
<span class="gp">$</span> setup_directfb_tslib
<span class="gp">$</span> <span class="nv">fontpath</span><span class="o">=</span><span class="k">$(</span>awk <span class="s1">'/^keyboard-font/{print $3}'</span> /etc/osk.conf<span class="k">)</span>
<span class="gp">$</span> charging-sdl -pcf <span class="s2">"</span><span class="nv">$fontpath</span><span class="s2">"</span>
</pre>
      </div>
      <h2>
       <span class="mw-headline" id="Troubleshooting">
        Troubleshooting
       </span>
      </h2>
      <h4>
       <span class="mw-headline" id="Charge_mode_not_detected">
        Charge mode not detected
       </span>
      </h4>
      <p>
       In order to detect if the device has been powered on in "charge mode", the initramfs script looks for specific options in the kernel cmdline (e.g.: androidboot.mode=charger).
      </p>
      <p>
       Kernel cmdline is the arguments Linux uses to boot. See
       <a class="external text" href="https://gitlab.com/postmarketOS/pmaports/blob/master/device/testing/device-lg-bullhead/deviceinfo#L23" rel="nofollow">
        this example
       </a>
       .
      </p>
      <p>
       Compare your kernel cmdline when powered on normally to when you power on by connecting the usb cable only. 
If you find a specific option to distinguish the two boot modes, please update the
       <a class="external text" href="https://gitlab.com/postmarketOS/pmaports/blob/master/main/postmarketos-mkinitfs/init_functions.sh#L509-516" rel="nofollow">
        initramfs script
       </a>
       .
      </p>
      <h4>
       <span id="DirectFB/FBDev:_No_supported_modes_found_in_/etc/fb.modes_and_current_mode_not_supported!">
       </span>
       <span class="mw-headline" id="DirectFB.2FFBDev:_No_supported_modes_found_in_.2Fetc.2Ffb.modes_and_current_mode_not_supported.21">
        DirectFB/FBDev: No supported modes found in /etc/fb.modes and current mode not supported!
       </span>
      </h4>
      <p>
       See
       <a class="external text" href="https://wiki.postmarketos.org/wiki/Osk-sdl#DirectFB.2FFBDev:_No_supported_modes_found_in_.2Fetc.2Ffb.modes_and_current_mode_not_supported.21" rel="nofollow">
        osk-sdl troubleshooting page
       </a>
      </p>
     </div>
    </div>
    <div class="catlinks" data-mw="interface" id="catlinks">
     <div class="mw-normal-catlinks" id="mw-normal-catlinks">
      <a href="../Special:Categories.html" title="Special:Categories">
       Category
      </a>
      :
      <ul>
       <li>
        <a href="../en/Category:Technical_Reference.html" title="Category:Technical Reference">
         Technical Reference
        </a>
       </li>
      </ul>
     </div>
    </div>
    <div class="visualClear">
    </div>
   </div>
  </div>
  <div id="footer" role="contentinfo" style="margin: 0">
   <ul id="footer-info">
    <li>
     Retrieved from "
     <a dir="ltr" href="https://wiki.postmarketos.org/index.php?title=Charging-sdl&amp;oldid=27406">
      https://wiki.postmarketos.org/index.php?title=Charging-sdl&amp;oldid=27406
     </a>
     "
    </li>
    <li id="footer-info-lastmod">
     This page was last edited on 4 May 2022, at 16:14.
    </li>
    <li id="footer-info-copyright">
     Content is available under
     <a class="external" href="https://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow">
      Creative Commons Attribution-ShareAlike
     </a>
     unless otherwise noted.
    </li>
    <br/>
   </ul>
   <ul id="footer-places">
    <li id="footer-places-privacy">
     <a href="../en/PostmarketOS:Privacy_policy.html" title="PostmarketOS:Privacy policy">
      Privacy policy
     </a>
    </li>
    <li id="footer-places-about">
     <a class="mw-redirect" href="../en/About_postmarketOS.html" title="PostmarketOS:About">
      About postmarketOS
     </a>
    </li>
    <li id="footer-places-disclaimer">
     <a href="../en/PostmarketOS:General_disclaimer.html" title="PostmarketOS:General disclaimer">
      Disclaimers
     </a>
    </li>
    <li id="footer-places-mobileview">
     <a class="noprint stopMobileRedirectToggle" href="https://wiki.postmarketos.org/index.php?title=Charging-sdl&amp;mobileaction=toggle_view_mobile">
      Mobile view
     </a>
    </li>
   </ul>
   <ul class="noprint" id="footer-icons">
    <li id="footer-copyrightico">
     <a href="https://creativecommons.org/licenses/by-sa/4.0/">
      <img alt="Creative Commons Attribution-ShareAlike" height="31" src="../cc-by-sa.png" width="88"/>
     </a>
    </li>
    <li id="footer-poweredbyico">
     <a href="https://www.mediawiki.org/">
      <img alt="Powered by MediaWiki" height="31" src="../poweredby_mediawiki_88x31.png" srcset="" width="88"/>
     </a>
    </li>
   </ul>
   <div style="clear: both;">
   </div>
  </div>
 </body>
</html>
