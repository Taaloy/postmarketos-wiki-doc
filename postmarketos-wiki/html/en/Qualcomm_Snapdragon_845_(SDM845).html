<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Qualcomm Snapdragon 845 (SDM845) - postmarketOS</title>
<link rel="stylesheet" href="../PostmarketOSWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.34.2">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="postmarketOS (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.postmarketos.org/api.php?action=rsd">
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<link rel="alternate" type="application/atom+xml" title="postmarketOS Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Qualcomm_Snapdragon_845_SDM845 rootpage-Qualcomm_Snapdragon_845_SDM845 skin-vector action-view">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	
	<div class="mw-indicators mw-body-content">
</div>

	<h1 id="firstHeading" class="firstHeading" lang="en">Qualcomm Snapdragon 845 (SDM845)</h1>
	
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From postmarketOS</div>
		<div id="contentSub"></div>
		
		
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#p-search">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">
<table class="infobox" cellspacing="3" style="border-spacing: 3px; width:22em;">
<caption class="" style="">Qualcomm SDM845</caption>
<tbody>
<tr class=""><td colspan="2" class="" style="text-align:center;">
<a href="../Sdm845.png" class="image"><img alt="" src="../Sdm845.png" decoding="async" width="200" height="193" srcset="../Sdm845.png 1.5x ../Sdm845.png 2x"></a>
</td></tr>
<tr class="">
<th scope="row" style="text-align:left;">Manufacturer</th>
    <td class="" style="">
Qualcomm</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Name</th>
    <td class="" style="">
SDM845</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Architecture</th>
    <td class="" style="">
aarch64</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">CPU</th>
    <td class="" style="">
4x 2.8 GHz Kryo 385 Gold, 4x 1.8 GHz Kryo 385 Silver</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">GPU</th>
    <td class="" style="">
Adreno 630</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Year</th>
    <td class="" style="">
2018</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Process</th>
    <td class="" style="">
10nm</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Mainline</th>
    <td class="" style="">
yes</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;"><abbr title="A link to a git{hub,lab} organisation/repo where development happens">Community Page</abbr></th>
    <td class="" style="">
<a rel="nofollow" class="external free" href="https://gitlab.com/sdm845-mainline">https://gitlab.com/sdm845-mainline</a>
</td>
</tr>
<tr><th colspan="2" class="" style="text-align:center;">Components</th></tr>
<tr class="">
<th scope="row" style="text-align:left;"><abbr title="SMP (bring up secondary CPU cores), CPU frequency scaling, CPUidle">CPU</abbr></th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">UART</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;"><abbr title="eMMC, SD cards, UFS, ...">Storage</abbr></th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">USB</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Display</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">GPU</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Pinctrl</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">IÂ²C</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;"><abbr title="Serial Peripheral Interface">SPI</abbr></th>
    <td class="" style="">
<div></div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Audio</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;"><abbr title="Hardware-accelerated video de/encoding">Video</abbr></th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Thermal</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">WiFi</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Bluetooth</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;"><abbr title="Calls, SMS, Internet">Modem</abbr></th>
    <td class="" style="">
<div class="feature feature-partial">Partial</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">GPS</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Camera</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr class="">
<th scope="row" style="text-align:left;">Suspend</th>
    <td class="" style="">
<div class="feature feature-yes">Works</div>
</td>
</tr>
<tr><td colspan="2" style="text-align:right"></td></tr>
</tbody>
</table>
<p><br>
</p>
<p><a rel="nofollow" class="external text" href="https://www.qualcomm.com/products/sdm845">SDM845</a> (or Snapdragon 845) is a Qualcomm SoC released in 2018, with mainline support originally added for the Dragonboard 845c. It is currently one of the fastest mobile SoCs booting Mainline with full support for hardware accelerated graphics, CPU frequency scaling and wifi/bluetooth, with more features on the way.
</p>
<p><br>
</p>
<div id="toc" class="toc">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2>Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Devices"><span class="tocnumber">1</span> <span class="toctext">Devices</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#SDM845_.28Snapdragon_845.29"><span class="tocnumber">1.1</span> <span class="toctext">SDM845 (Snapdragon 845)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#UFS_internal_storage"><span class="tocnumber">2</span> <span class="toctext">UFS internal storage</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Join_Us.21"><span class="tocnumber">3</span> <span class="toctext">Join Us!</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Adding_yours"><span class="tocnumber">4</span> <span class="toctext">Adding yours</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Audio"><span class="tocnumber">5</span> <span class="toctext">Audio</span></a></li>
<li class="toclevel-1 tocsection-7">
<a href="#Modem"><span class="tocnumber">6</span> <span class="toctext">Modem</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#References"><span class="tocnumber">6.1</span> <span class="toctext">References</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#Wakeups"><span class="tocnumber">7</span> <span class="toctext">Wakeups</span></a>
<ul>
<li class="toclevel-2 tocsection-10">
<a href="#Context"><span class="tocnumber">7.1</span> <span class="toctext">Context</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#Glink"><span class="tocnumber">7.1.1</span> <span class="toctext">Glink</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#QRTR"><span class="tocnumber">7.1.2</span> <span class="toctext">QRTR</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#QMI"><span class="tocnumber">7.1.3</span> <span class="toctext">QMI</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#In_summary"><span class="tocnumber">7.1.4</span> <span class="toctext">In summary</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="#Waking_up_for_calls_and_SMS"><span class="tocnumber">7.2</span> <span class="toctext">Waking up for calls and SMS</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Waking_up_for_notifications"><span class="tocnumber">7.3</span> <span class="toctext">Waking up for notifications</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#WiFi"><span class="tocnumber">8</span> <span class="toctext">WiFi</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Display"><span class="tocnumber">9</span> <span class="toctext">Display</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#I2C"><span class="tocnumber">10</span> <span class="toctext">I2C</span></a></li>
<li class="toclevel-1 tocsection-20"><a href="#Bluetooth"><span class="tocnumber">11</span> <span class="toctext">Bluetooth</span></a></li>
<li class="toclevel-1 tocsection-21"><a href="#Haptics"><span class="tocnumber">12</span> <span class="toctext">Haptics</span></a></li>
<li class="toclevel-1 tocsection-22">
<a href="#Bootloaders"><span class="tocnumber">13</span> <span class="toctext">Bootloaders</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="#Renegade_Project"><span class="tocnumber">13.1</span> <span class="toctext">Renegade Project</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#uboot"><span class="tocnumber">13.2</span> <span class="toctext">uboot</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-25"><a href="#See_also"><span class="tocnumber">14</span> <span class="toctext">See also</span></a></li>
<li class="toclevel-1 tocsection-26"><a href="#Who.27s_working_on_it"><span class="tocnumber">15</span> <span class="toctext">Who's working on it</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Devices">Devices</span></h2>
<h3>
<span id="SDM845_(Snapdragon_845)"></span><span class="mw-headline" id="SDM845_.28Snapdragon_845.29">SDM845 (Snapdragon 845)</span>
</h3>
<table class="cargoTable noMerge sortable">
<thead><tr>
<th class="field_Device">Device</th>
<th class="field_Codename">Codename</th>
<th class="field_Mainline">Mainline</th>
</tr></thead>
<tbody>
<tr>
<td class="field_Device"><a href="../en/Google_Pixel_3_(google-blueline).html" title="Google Pixel 3 (google-blueline)">Google Pixel 3</a></td>
<td class="field_Codename">google-blueline</td>
<td class="field_Mainline">P</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Google_Pixel_3_XL_(google-crosshatch).html" title="Google Pixel 3 XL (google-crosshatch)">Google Pixel 3 XL</a></td>
<td class="field_Codename">google-crosshatch</td>
<td class="field_Mainline"></td>
</tr>
<tr>
<td class="field_Device"><a href="../en/LG_G7_ThinQ_(lg-judyln).html" title="LG G7 ThinQ (lg-judyln)">LG G7 ThinQ</a></td>
<td class="field_Codename">lg-judyln</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/LG_V35_ThinQ_(lg-judyp).html" title="LG V35 ThinQ (lg-judyp)">LG V35 ThinQ</a></td>
<td class="field_Codename">lg-judyp</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Meizu_16th_(meizu-m1882).html" title="Meizu 16th (meizu-m1882)">Meizu 16th</a></td>
<td class="field_Codename">meizu-m1882</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/OnePlus_6_(oneplus-enchilada).html" title="OnePlus 6 (oneplus-enchilada)">OnePlus 6</a></td>
<td class="field_Codename">oneplus-enchilada</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/OnePlus_6T_(oneplus-fajita).html" title="OnePlus 6T (oneplus-fajita)">OnePlus 6T</a></td>
<td class="field_Codename">oneplus-fajita</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Samsung_Galaxy_S9_(samsung-starqltechn).html" title="Samsung Galaxy S9 (samsung-starqltechn)">Samsung Galaxy S9 (SM-G9600/DS)</a></td>
<td class="field_Codename">samsung-starqltechn</td>
<td class="field_Mainline"></td>
</tr>
<tr>
<td class="field_Device"><a href="../en/SHIFT_SHIFT6mq_(shift-axolotl).html" title="SHIFT SHIFT6mq (shift-axolotl)">SHIFT SHIFT6mq</a></td>
<td class="field_Codename">shift-axolotl</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Sony_Xperia_XZ2_(sony-akari).html" title="Sony Xperia XZ2 (sony-akari)">Sony Xperia XZ2</a></td>
<td class="field_Codename">sony-akari</td>
<td class="field_Mainline">P</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Sony_Xperia_XZ2_Compact_(sony-apollo).html" title="Sony Xperia XZ2 Compact (sony-apollo)">Sony Xperia XZ2 Compact</a></td>
<td class="field_Codename">sony-apollo</td>
<td class="field_Mainline">P</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Sony_Xperia_XZ3_(sony-akatsuki).html" title="Sony Xperia XZ3 (sony-akatsuki)">Sony Xperia XZ3</a></td>
<td class="field_Codename">sony-akatsuki</td>
<td class="field_Mainline">P</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Thundercomm_Dragonboard-845c_(thundercomm-db845c).html" title="Thundercomm Dragonboard-845c (thundercomm-db845c)">Thundercomm Dragonboard 845c</a></td>
<td class="field_Codename">thundercomm-db845c</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Xiaomi_Mi_8_(xiaomi-dipper).html" title="Xiaomi Mi 8 (xiaomi-dipper)">Xiaomi Mi 8/Mi 8 Pro</a></td>
<td class="field_Codename">xiaomi-dipper, xiaomi-equuleus</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Xiaomi_Mi_Mix_2S_(xiaomi-polaris).html" title="Xiaomi Mi Mix 2S (xiaomi-polaris)">Xiaomi Mi Mix 2S</a></td>
<td class="field_Codename">xiaomi-polaris</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Xiaomi_Mix_3_(xiaomi-perseus).html" title="Xiaomi Mix 3 (xiaomi-perseus)">Xiaomi Mix 3</a></td>
<td class="field_Codename">xiaomi-perseus</td>
<td class="field_Mainline">Y</td>
</tr>
<tr>
<td class="field_Device"><a href="../en/Xiaomi_POCO_F1_(xiaomi-beryllium).html" title="Xiaomi POCO F1 (xiaomi-beryllium)">Xiaomi Pocophone F1 / POCO F1</a></td>
<td class="field_Codename">xiaomi-beryllium</td>
<td class="field_Mainline">Y</td>
</tr>
</tbody>
</table>
<h2><span class="mw-headline" id="UFS_internal_storage">UFS internal storage</span></h2>
<table role="text container" style="color: inherit; background-color: #fee7e6; border: 1px solid #d33; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center;"><span style="white-space: nowrap;"><img alt="Icon" src="../Red_warning_icon.svg" decoding="async" title="Icon" width="20" height="20" srcset="../Red_warning_icon.svg 1.5x ../Red_warning_icon.svg 2x"></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>WARNING:</b> IF YOUR DEVICE IS A SONY XPERIA DO NOT NEVER EVER EVER TRY TO ENABLE UFS ON NON-VENDOR/NON-SODP KERNELS! IT WILL ERASE THE CHIP CLEAN (INCLUDING THE BOOTLOADER!) CONSIDER YOURSELF WARNED</td>
</tr></tbody></table>
<h2>
<span id="Join_Us!"></span><span class="mw-headline" id="Join_Us.21">Join Us!</span>
</h2>
<p>If you own an SDM845 device and want to get postmarketOS &amp; mainline booting, head over to the <a rel="nofollow" class="external text" href="https://matrix.to/#/#mainline:postmarketos.org">#mainline:postmarketos.org postmarketOS mainline channel</a>.
</p>
<p>We also discuss packaging, other distros and various other non-porting stuff on matrix: <a rel="nofollow" class="external text" href="https://matrix.to/#/#sdm845:postmarketos.org">#sdm845:postmarketos.org</a>.
</p>
<p>Feel free to ping <a rel="nofollow" class="external text" href="https://matrix.to/#/@caleb:postmarketos.org">@caleb:postmarketos.org</a>.
</p>
<h2><span class="mw-headline" id="Adding_yours">Adding yours</span></h2>
<p>If you have an SDM845 based device that isn't in this list you should definitely do something about that, checkout the <a href="../en/SDM845_Mainlining.html" title="SDM845 Mainlining">SDM845 Mainlining Guide</a> for instructions on porting new devices. It is fairly straightforward to get core functionality working on most devices.
</p>
<span style="display:block; height: 40px; float: left;"><div class="floatleft"><a href="../Icon-numix-light-system-run.svg" class="image"><img alt="Icon-numix-light-system-run.svg" src="../Icon-numix-light-system-run.svg" decoding="async" width="32" height="32" srcset="../48px-Icon-numix-light-system-run.svg 1.5x ../64px-Icon-numix-light-system-run.svg 2x"></a></div>
<a href="../en/SDM845_Mainlining.html" title="SDM845 Mainlining"><span style="border: 1px solid lightgray; background: #f8f8f8; padding: 5px; width:200px; height: 20px; line-height: 20px; display: inline-block; margin-left: 5px;">SDM845 Mainlining</span></a></span><p><span style="clear:left; display: block"></span>
</p>
<h2><span class="mw-headline" id="Audio">Audio</span></h2>
<p>The kernel side audio stuff is mostly functional on SDM845.
</p>
<ul>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/sdm845-mainline/linux/-/commit/b0484a0f4f80367a87fa7c24ca045921e3140f34">Support for OnePlus 6 added here</a></li>
<li>
<a rel="nofollow" class="external text" href="https://gitlab.com/sdm845-mainline/linux/-/commit/60f8ffa05327527396c7165841b1478904d04b30">Hack needed to fix the OnePlus 6 speaker</a> (WHY???)</li>
</ul>
<h2><span class="mw-headline" id="Modem">Modem</span></h2>
<p>The modem is booted by the Q6V5 MSS Peripheral Image Loader, it is required to boot the WiFi adapter. It is exposed via the QRTR_NET layer, a custom shared memory transport layer developed by Qualcomm. Over this the standard QMI interface is exposed. ModemManager has great support for QRTR and thus it is possible to send/receive SMS, use mobile data and make calls.
</p>
<p><br>
</p>
<h3><span class="mw-headline" id="References">References</span></h3>
<ul><li>
<a rel="nofollow" class="external text" href="https://gitlab.com/postmarketOS/pmaports/-/merge_requests/1356">pmaports!1356</a> Relevant discussion on renaming the msm-modem package as rpmsgexport is not needed on SDM845.</li></ul>
<h2><span class="mw-headline" id="Wakeups">Wakeups</span></h2>
<p>Wakeups are a concept in the Linux kernel referring to a specific device or subdevice that can cause the system to exit suspend, usually via an interrupt. A good example of this is the power button, when pressed it fires an interrupt, and because that interrupt is denoted as a "wakeirq" (an interrupt that when fired _should_ wake the system from suspend) that's exactly what happens.
</p>
<h3><span class="mw-headline" id="Context">Context</span></h3>
<p>Qualcomm platforms currently (at least as far back as SDM845) don't have a real suspend mode. The closest we get is suspend to idle (s2idle), this has the kernel freeze all of userspace and almost all kernel threads. In s2idle, peripherals (e.g. the touchscreen) can be powered down, the CPU timers (which usually fire periodic interrupts) are disabled, and the CPUs are able to spend the majority of their time in their lowest idle states. This isn't enough to enable a device to go for days at a time without charging, but it is more than enough to get through a single day at least.
</p>
<p>When in s2idle, all interrupts are disabled with two exceptions: (enabled) wakeirqs, and irqs with the <code>IRQF_NO_SUSPEND</code> flag. Wakeirqs may not always be enabled, for example if your touchscreen has a double tap to wake feature then the driver would denote its IRQ as "wakeup capable", this associated a "wakeup" with the interrupt. The wakeup can then be enabled via sysfs or in the driver somewhere. If a wakeup capable interrupt doesn't have its wakeup feature enabled then the irq will be disabled during s2idle.
</p>
<p>The <code>IRQF_NO_SUSPEND</code> flag enables a driver to run its interrupt handler and process interrupts while the kernel is in s2idle. This is useful for some essential housekeeping duties that have to happen even when the user isn't interacting with the device.
</p>
<h4><span class="mw-headline" id="Glink">Glink</span></h4>
<p>Glink is a communication mechanism used by Qualcomm SoCs to enable communication between the different processors (e.g. the Modem, Audio/Compute DSPs and Sensor DSP). It is a peer to peer system based on shared memory, every pair of processors (e.g. the AP (Linux) and Modem) have their own glink edge made up of a shared memory region and a pair of interrupts, one on the modem side and one for us. To provide a very simplified explanation: data is sent and received by finding a free "bucket" in the shared memory region, putting your data in the bucket, and then triggering an interrupt on the other side.
</p>
<p>Glink is a kind of mesh network where (for the most part) every processor is connected to every other. It represents the "Link Layer".
</p>
<p>The Glink driver makes use of the <code>IRQF_NO_SUSPEND</code> flag, meaning that even when in s2idle the kernel will still process interrupts from Glink. This allows for pending messages to be handled and queued up for userspace where they might otherwise be missed.
</p>
<h4><span class="mw-headline" id="QRTR">QRTR</span></h4>
<p>On top of glink is the protocol layer, QRTR (Pronounced Q-Router). QRTR is a socket-based network protocol that allows for a much higher level of communication. Each processor can expose services over the QRTR network, programs on other processors can connect to and utilise these services. For example, the modem provides a Wireless Data Service for configuring a mobile data connection, the Sensor DSP also provides its own service for retreiving sensor data (See <a href="../en/Qualcomm_Snapdragon_Sensor_Core.html" title="Qualcomm Snapdragon Sensor Core">Qualcomm_Snapdragon_Sensor_Core</a>).
</p>
<p>QRTR represents the "Internet Layer", performing routing and session management.
</p>
<h4><span class="mw-headline" id="QMI">QMI</span></h4>
<p>QMI is a TLV (Type-Length-Value) binary format. It predates QRTR and is quite common in modems. It serves as the transport layer, however it also defines what messages can be sent/received and how the messages are formatted. QMI is the only mechanism used by ModemManager to communicate with the modem to initiate calls, send SMS, retrieve SIM and signal status information, cell tower information, etc. An incoming call or SMS is signalled by the modem sending a QMI message.
</p>
<h4><span class="mw-headline" id="In_summary">In summary</span></h4>
<p>Walking back down the stack, when you receive a phone call, the modem will check that you have an active QRTR session with it (this will be the case if ModemManager hasn't explicitly closed the connection) which is subscribed to incoming calls. It will send a QMI message to notify ModemManager. It goes roughly as follows:
</p>
<p>1. The message is transported over QRTR and sent via Glink.<br>
2. The Glink interrupt will fire and run the interrupt handler in the kernel.<br>
3. The interrupt handler reads the message and passes it on the QRTR protocol implementation in the kernel.<br>
4. The QRTR net code queues it up to be received by userspace on the next poll()<br>
</p>
<p>This is all well and good, however when we're in s2idle, userspace is frozen, there's no way to handle the message, figure out that it's a call, and make the phone ring.
</p>
<h3><span class="mw-headline" id="Waking_up_for_calls_and_SMS">Waking up for calls and SMS</span></h3>
<p>Without a way to properly differentiate between a signal strength change and an incoming call, it isn't possible for the kernel to know which messages from the modem should cause a wakeup, and which should not. All we have is a global switch.
</p>
<p>The ideal solution here is that ModemManager becomes capable of disabling all non-essential notifications from the modem before the device suspends, this ought(?) to be possible but it's unclear how hard it would be.
</p>
<p>For now, you can make sure that you never miss a call by waking up for every incoming message from the modem. This would be acceptable if it were possible to do this without immediately turning on the display, and if the message isn't a call or SMS, automatically suspending again. For Phosh, I believe this requires support to be added to GNOME session daemon to wake up without turning on the display. Figuring out why the device woke up (maybe it was a power button press or USB cable insertion) requires keeping track of all the counts in <code>/sys/class/wakeup/wakeup*/wakeup_count</code> and then having a look up table for each wakeup (to know that e.g. wakeup <code>/sys/devices/platform/soc@0/c440000.spmi/spmi-0/0-00/c440000.spmi:pmic@0:pon@800/c440000.spmi:pmic@0:pon@800:pwrkey/wakeup</code> is associated with the power button)
</p>
<p>You can enable this wakeup for yourself by running the following command as root:
</p>
<pre>echo enabled &gt; /sys/bus/rpmsg/devices/4080000.remoteproc:glink-edge.IPCRTR.-1.-1/power/wakeup
</pre>
<p>This will cause the device to wake up for all incoming data from the modem.
</p>
<h3><span class="mw-headline" id="Waking_up_for_notifications">Waking up for notifications</span></h3>
<p>When on a mobile data connection, the IPA (Qualcomm dedicated network packet routing hardware) will wake up the device by default for any incoming data, this usually has no effect as most TCP connections have a relatively short TCP keepalive time. However the plan is to disable it by default for now (see <a rel="nofollow" class="external text" href="https://gitlab.com/postmarketOS/pmaports/-/merge_requests/4122">pmaports!4122</a>) to avoid any confusion.
</p>
<p>The IPA has the ability to maintain a TCP connection and perform some arbitrary filtering to avoid waking up the device for things that aren't notifications, e.g. matching on source IP or specific magic bytes in the packet. Unfortunately the mainline kernel driver doesn't yet implement any of these features.
</p>
<p>The Wifi on SDM845 is ath10k and includes full Wake-On-WLAN (WoWLAN) support! Using the <code>iw</code> utility it's possible to enable waking up on actions like wifi disconnect, specific SSIDs becoming available, or via packet matching based on source/destination IP, magic bytes, etc.
</p>
<p>Ath10k hardware supports offloading station keepalive, where it will send null packets to whatever AP your device is connected to in order to ensure that it doesn't get dropped. However this feature is explicitly disabled (via <a rel="nofollow" class="external text" href="https://lore.kernel.org/all/1421749440-10457-2-git-send-email-michal.kazior@tieto.com/">This patch</a>) in favour of software polling, perhaps worth reinvestigating!
</p>
<p>A notification push client service could be taught how to utilise WoWLAN and the IPA to maintain a persistent TCP connection with the server and cause the device to wake up for incoming notifications. It should be possible to also implement automatic switching between mobile data and wifi, between wifi networks, and between mobile cell towers. WoWLAN can wake up on wifi disconnect, and the modem can wake up when switching cell tower, allowing the connection to be re-established. A very long keepalive time will ensure that it doesn't drop for some other reason.
</p>
<h2><span class="mw-headline" id="WiFi">WiFi</span></h2>
<p>Wifi is functional! Firmware for the modem and ath10k module must be loaded in order to have functional wifi.
</p>
<p>3 packages are required for functional wifi:
</p>
<p>rmtfs, pd-mapper and tqftpserv can be installed with
</p>
<p><code>apk add rmtfs pd-mapper tqftpserv</code>
</p>
<p>(<a rel="nofollow" class="external text" href="https://gitlab.com/postmarketOS/pmaports/-/merge_requests/1080">pmaports!1080</a>).
</p>
<p><a rel="nofollow" class="external text" href="https://github.com/jhugo/linux/tree/5.5rc2_wifi">This readme</a> can then be followed to fixup the firmware.
</p>
<p>Some devices need <a rel="nofollow" class="external text" href="https://github.com/torvalds/linux/blob/0cdd776ec92c0fec768c7079331804d3e52d4b27/arch/arm64/boot/dts/qcom/sdm845-oneplus-common.dtsi#L671">this quirk</a> enabled for ath10k probe to succeed.
</p>
<p>More details may also be found on the <a rel="nofollow" class="external text" href="https://wiki.postmarketos.org/wiki/Qualcomm_Snapdragon_835_(MSM8998)#WLAN">Snapdragon 835 SoC page</a>.
</p>
<h2><span class="mw-headline" id="Display">Display</span></h2>
<p>The Adreno 630 is relatively easy to work with, after adding a driver for your panel, obtain <a rel="nofollow" class="external text" href="https://gitlab.com/sdm845-mainline/sdm845-linux-next/-/commit/41ac945f035a7facab53b43d7c3506870f1fb2b4">the firmware</a> from
your device and either compile into the kernel (in addition to enabling CONFIG_DRM_FBDEV_EMULATION for early dmesg)) or add to the right subdirectory under /lib/firmware.
</p>
<p><br>
</p>
<h2><span class="mw-headline" id="I2C">I2C</span></h2>
<p>I2C and the Geni hardware is functional and supported, however it is missing a driver for special GPI DMA mode used by a few devices (e.g. touchscreen on Enchilada). As of 5.11-rc1 geni is capable of DMA, however not through the GPI hardware. The issues previously discussed here no longer apply.
</p>
<ul><li>WIP GPI DMA driver in mainline: <a rel="nofollow" class="external free" href="https://patchwork.kernel.org/patch/11732405/">https://patchwork.kernel.org/patch/11732405/</a>
</li></ul>
<h2><span class="mw-headline" id="Bluetooth">Bluetooth</span></h2>
<p>Bluetooth works!
</p>
<h2><span class="mw-headline" id="Haptics">Haptics</span></h2>
<p>Haptics is supported! See <a href="../en/Haptics.html" title="Haptics">Haptics</a> for more details.
</p>
<h2><span class="mw-headline" id="Bootloaders">Bootloaders</span></h2>
<h3><span class="mw-headline" id="Renegade_Project">Renegade Project</span></h3>
<p>Renegade Project support some sdm845 device
</p>
<h3><span class="mw-headline" id="uboot">uboot</span></h3>
<p>In progress <a rel="nofollow" class="external text" href="https://github.com/dsankouski/u-boot/tree/starqltechn_wip/board/samsung/starqltechn">u-boot port</a> exists
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="../en/OnePlus_6_(oneplus-enchilada).html" title="OnePlus 6 (oneplus-enchilada)">OnePlus_6_(oneplus-enchilada)</a></li>
<li>
<a rel="nofollow" class="external text" href="https://gitlab.com/sdm845-mainline/linux">SDM845 Linux mainline kernel fork</a> a common near-mainline kernel tree for SDM845 device development, this is the kernel shipped in postmarketOS and Mobian.</li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/postmarketOS/pmaports/-/tree/master/device/community/linux-postmarketos-qcom-sdm845">SDM845 kernel package</a></li>
<li><a rel="nofollow" class="external text" href="https://fosdem.org/2022/schedule/event/mobile_kernel_snapdragon_845/">Caleb's 2022 FOSDEM talk on mainlining the Snapdragon 845</a></li>
</ul>
<h2>
<span id="Who's_working_on_it"></span><span class="mw-headline" id="Who.27s_working_on_it">Who's working on it</span>
</h2>
<ul>
<li>
<a href="../User:Kalube.html" title="User:Kalube">User:kalube</a> (@caleb:postmarketos.org on Matrix)</li>
<li>
<a href="../User:Venji10.html" title="User:Venji10">User:venji10</a> (@venji10 on Matrix)</li>
<li>
<a href="../User:Joel.html" title="User:Joel">User:Joel</a> (@jo:jsfamily.in on Matrix)</li>
<li>
<a href="../User:Dsankouski.html" title="User:Dsankouski">User:Dsankouski</a> (@dsankouski on Matrix) - u-boot porting for <a href="../en/Samsung_Galaxy_S9_(samsung-starqltechn).html" title="Samsung Galaxy S9 (samsung-starqltechn)">Samsung_Galaxy_S9_(samsung-starqltechn)</a>
</li>
<li>'<i><b>And more...'</b></i>
</li>
</ul>
<table role="text container" style="color: inherit; background-color: #fdd1d1; border: 1px solid #b60000; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center;"><span style="white-space: nowrap;"><img alt="Icon" src="../Red_warning_icon.svg" decoding="async" title="Icon" width="20" height="20" srcset="../Red_warning_icon.svg 1.5x ../Red_warning_icon.svg 2x"></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>TODO:</b> add more devs :D</td>
</tr></tbody></table>
<p><br>
</p>
</div></div>
		
		<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Socs.html" title="Category:Socs">Socs</a></li>
<li><a href="../en/Category:Todo_Items.html" title="Category:Todo Items">Todo Items</a></li>
</ul>
</div></div>
		<div class="visualClear"></div>
		
	</div>
</div>


		<div id="footer" role="contentinfo" style="margin: 0">
						<ul id="footer-info">
								<li>Retrieved from "<a dir="ltr" href="https://wiki.postmarketos.org/index.php?title=Qualcomm_Snapdragon_845_(SDM845)&amp;oldid=45276">https://wiki.postmarketos.org/index.php?title=Qualcomm_Snapdragon_845_(SDM845)&amp;oldid=45276</a>"</li>
		
		<li id="footer-info-lastmod"> This page was last edited on 20 June 2023, at 19:17.</li>
								<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
							<br>
</ul>
						<ul id="footer-places">
								<li id="footer-places-privacy"><a href="../en/PostmarketOS:Privacy_policy.html" title="PostmarketOS:Privacy policy">Privacy policy</a></li>
								<li id="footer-places-about"><a href="../en/About_postmarketOS.html" class="mw-redirect" title="PostmarketOS:About">About postmarketOS</a></li>
								<li id="footer-places-disclaimer"><a href="../en/PostmarketOS:General_disclaimer.html" title="PostmarketOS:General disclaimer">Disclaimers</a></li>
								<li id="footer-places-mobileview"><a href="https://wiki.postmarketos.org/index.php?title=Qualcomm_Snapdragon_845_(SDM845)&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li>
							</ul>
										<ul id="footer-icons" class="noprint">
										<li id="footer-copyrightico">
						<a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="../cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31"></a>					</li>
										<li id="footer-poweredbyico">
						<a href="https://www.mediawiki.org/"><img src="../poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="" width="88" height="31"></a>					</li>
									</ul>
						<div style="clear: both;"></div>
		</div>
		

</body>
</html>
