<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Pmbootstrap/Cross Compiling - postmarketOS Wiki</title>
<link rel="stylesheet" href="../PostmarketOSWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.39.10">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="postmarketOS Wiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.postmarketos.org/api.php?action=rsd">
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<link rel="alternate" type="application/atom+xml" title="postmarketOS Wiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Pmbootstrap_Cross_Compiling rootpage-Pmbootstrap_Cross_Compiling skin-vector-2022 action-view skin--responsive vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
<div class="mw-page-container">
	<span id="top-page"></span>
	<a class="mw-jump-link" href="#content">Jump to content</a>
	<div class="mw-page-container-inner">
		<input type="checkbox" id="mw-sidebar-checkbox" class="mw-checkbox-hack-checkbox">
		<header class="mw-header">
			<div class="mw-header-aside">
			<label id="mw-sidebar-button" class="mw-checkbox-hack-button mw-ui-icon mw-ui-button mw-ui-quiet mw-ui-icon-element" for="mw-sidebar-checkbox" role="button" aria-controls="mw-panel" data-event-name="ui.sidebar" tabindex="0" title="Main menu">
				<span>Toggle sidebar</span>
			</label>
			
<a href="../en/Main_Page.html" class="mw-logo">
	<img class="mw-logo-icon" src="/logo_50x50.svg" alt="" aria-hidden="true" height="50" width="50">
	<span class="mw-logo-container">
		<strong class="mw-logo-wordmark">postmarketOS Wiki</strong>
	</span>
</a>

			</div>
			<div class="mw-header-content">
			
<div id="p-search" role="search" class="vector-search-box-vue  vector-search-box-collapses  vector-search-box-show-thumbnail vector-search-box-auto-expand-width vector-search-box">
	<a href="../Special:Search.html" title="Search postmarketOS Wiki [f]" accesskey="f" class="mw-ui-button mw-ui-quiet mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-search search-toggle">
		<span>Search</span>
	</a>
	
	<div>
		<form action="/index.php" id="searchform" class="vector-search-box-form">
			<div id="simpleSearch" class="vector-search-box-inner" data-search-loc="header-moved">
				<input class="vector-search-box-input" type="search" name="search" placeholder="Search postmarketOS Wiki" aria-label="Search postmarketOS Wiki" autocapitalize="sentences" title="Search postmarketOS Wiki [f]" accesskey="f" id="searchInput">
				<input type="hidden" name="title" value="Special:Search">
				<input id="mw-searchButton" class="searchButton mw-fallbackSearchButton" type="submit" name="fulltext" title="Search the pages for this text" value="Search">
				<input id="searchButton" class="searchButton" type="submit" name="go" title="Go to a page with this exact name if it exists" value="Go">
			</div>
		</form>
	</div>
</div>

			<nav class="vector-user-links" aria-label="Personal tools" role="navigation">
	

<div id="p-vector-user-menu-overflow" class="vector-menu mw-portlet mw-portlet-vector-user-menu-overflow vector-user-menu-overflow">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="pt-createaccount-2" class="user-links-collapsible-item mw-list-item"><a href="../Special:RequestAccount.html"><span>Request account</span></a></li></ul>
		
	</div>
</div>

	

<div id="p-personal" class="vector-menu mw-portlet mw-portlet-personal vector-user-menu vector-user-menu-logged-out vector-menu-dropdown" title="More options">
	<input type="checkbox" id="p-personal-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-personal" class="vector-menu-checkbox">
	<label id="p-personal-label" for="p-personal-checkbox" class="vector-menu-heading mw-ui-button mw-ui-quiet mw-ui-icon mw-ui-icon-element mw-ui-icon-ellipsis mw-ui-icon-wikimedia-ellipsis">
		<span class="vector-menu-heading-label">Personal tools</span>
	</label>
	<div class="vector-menu-content">
		<div class="vector-user-menu-create-account"><a href="/index.php?title=Special:CreateAccount&amp;returnto=Pmbootstrap%2FCross+Compiling" class="vector-menu-content-item user-links-collapsible-item" title="You are encouraged to create an account and log in; however, it is not mandatory"><span class="mw-ui-icon mw-ui-icon-userAdd mw-ui-icon-wikimedia-userAdd"></span> <span>Create account</span></a></div>
<div class="vector-user-menu-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Pmbootstrap%2FCross+Compiling" class="vector-menu-content-item vector-menu-content-item-login" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span class="mw-ui-icon mw-ui-icon-logIn mw-ui-icon-wikimedia-logIn"></span> <span>Log in</span></a></div>

		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

</nav>

			</div>
		</header>
		<div class="vector-sidebar-container vector-sidebar-container-no-toc">
			</div>
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<input type="checkbox" id="vector-toc-collapsed-checkbox" class="mw-checkbox-hack-checkbox">
		<div class="mw-table-of-contents-container">
			<div class="vector-sticky-toc-container mw-sticky-header-element">
				
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<a id="top"></a>
				<header class="mw-body-header">
				
				
				    <h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Pmbootstrap/Cross Compiling</span></h1>
				</header>
				<nav class="vector-article-toolbar" aria-label="Tools" role="navigation">
					<div class="mw-article-toolbar-container">
						<div id="left-navigation">
							

<div id="p-associated-pages" class="vector-menu mw-portlet mw-portlet-associated-pages vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-nstab-main" class="selected mw-list-item"><a href="../en/Pmbootstrap_Cross_Compiling.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="new mw-list-item"><a href="/index.php?title=Talk:Pmbootstrap/Cross_Compiling&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t"><span>Discussion</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-label="Change language variant">
	<label id="p-variants-label" for="p-variants-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</div>

						</div>
						<div id="right-navigation" class="vector-collapsible ">
							

<div id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-view" class="selected mw-list-item"><a href="../en/Pmbootstrap_Cross_Compiling.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="mw-list-item"><a href="/index.php?title=Pmbootstrap/Cross_Compiling&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="mw-list-item"><a href="/index.php?title=Pmbootstrap/Cross_Compiling&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

							

<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-has-collapsible-items" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox">
	<label id="p-cactions-label" for="p-cactions-checkbox" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Pmbootstrap_Cross_Compiling.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Pmbootstrap/Cross_Compiling&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Pmbootstrap/Cross_Compiling&amp;action=history"><span>View history</span></a></li>
</ul>
		
	</div>
</div>

						</div>
					</div>
				</nav>
				<div id="bodyContent" class="vector-body" data-mw-ve-target-container>
					<div class="mw-body-subheader">
					        <div class="mw-indicators">
        </div>

					    <div id="siteSub" class="noprint">From postmarketOS Wiki</div>
					</div>
					
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p>This article explains how <a href="../en/Pmbootstrap.html" title="Pmbootstrap">pmbootstrap</a> builds foreign arch packages. Depending on the package type, one of these methods is used:
</p>
<ul>
<li>Native: kernels, bootloaders, firmware packages</li>
<li>Crossdirect: everything else</li>
<li>QEMU: fallback if crossdirect does not work (slow)</li>
</ul>
<h2><span class="mw-headline" id="Native">Native</span></h2>
<p>Set <code>options="pmb:cross-native"</code> in the APKBUILD to use this method. <a href="../en/Pmaports.git.html" class="mw-redirect" title="Pmaports">pmaports</a> CI scripts ensure that linux packages etc. use this method.
</p>
<p>This is the fastest method, it gets used when the package does not have any dependencies on packages in the target architecture. pmbootstrap runs Alpine's abuild in the native chroot, installs the cross compiler related packages and sets environment variables like <code>CARCH</code>, <code>CROSS_COMPILE</code> and <code>CC</code> to instruct abuild and the kernels' build system (that also gets used in u-boot) to produce a foreign arch package.
</p>
<h2><span class="mw-headline" id="Crossdirect">Crossdirect</span></h2>
<p>pmbootstrap uses this method by default.
</p>
<p>The native chroot gets mounted in the foreign arch chroot (e.g. armhf) at <code>/native</code>. The <a rel="nofollow" class="external text" href="https://gitlab.com/postmarketOS/pmaports/-/blob/master/cross/crossdirect/APKBUILD">crossdirect package</a> gets installed into the native chroot, and creates wrapper scripts:
</p>
<ul>
<li>
<code>/native/usr/lib/crossdirect/armhf/gcc</code> -&gt; <code>/native/usr/bin/armv6-alpine-linux-muslgnueabihf-gcc</code>
</li>
<li>
<code>/native/usr/lib/crossdirect/armhf/rustc</code> -&gt; <code>/native/usr/bin/rustc --target=armv6-alpine-linux-musleabihf …</code>
</li>
</ul>
<p>When building packages in the armhf chroot, <code>PATH</code> will get prepended with <code>/native/usr/lib/crossdirect/armhf</code>. This leads to invoking the cross compiler from the native chroot, running at native speed, whenever calling the compiler from the foreign arch chroot.
</p>
<h3><span class="mw-headline" id="Rust">Rust</span></h3>
<p>Rust support in crossdirect is still experimental. <a rel="nofollow" class="external text" href="https://gitlab.postmarketos.org/postmarketOS/pmaports/-/merge_requests/4234">pmaports!4234</a> (cross/crossdirect: improve rust handling) describes some of the problems with it.
</p>
<h4><span class="mw-headline" id="CARGO_HOME">CARGO_HOME</span></h4>
<p>If a program needs to download git repositories of dependencies with cargo (ideally they are bundled with the source tarball and don't need to be downloaded), then these git repositories are cached with pmbootstrap. This works as long as the program does not override <a rel="nofollow" class="external text" href="https://doc.rust-lang.org/cargo/guide/cargo-home.html">CARGO_HOME</a>. GNOME podcasts does this for example, so if building gnome-podcasts from the git repository with <code>pmbootstrap build --src</code>, patch out the override of CARGO_HOME so the dependencies do not get downloaded for every build.
</p>
<h4><span class="mw-headline" id="Packaging_caveats">Packaging caveats</span></h4>
<ul>
<li>
<code>cargo auditable build</code> is unsupported and falls back to compiling in QEMU. Change it to <code>cargo build</code> to build the package with the native compiler.</li>
<li>Running tests doesn't really work (e.g. when building squeekboard, the tests hang and time out).</li>
</ul>
<h2><span class="mw-headline" id="QEMU">QEMU</span></h2>
<p>Use <code>pmbootstrap --no-cross</code> or set <code>options="!pmb:crossdirect"</code> in the APKBUILD to use this method.
</p>
<p>pmbootstrap installs everything into the foreign arch chroot and runs the build through QEMU user emulation. This is the most reliable method, but it is much slower than cross compiling. Use this as workaround if your package does not build with crossdirect.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="../en/Pmbootstrap.html" title="Pmbootstrap">pmbootstrap</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/postmarketOS/pmaports/-/blob/master/cross/crossdirect/APKBUILD">crossdirect in pmaports</a></li>
<li>
<a rel="nofollow" class="external text" href="https://cast.postmarketos.org/episode/30-Interview-Natanael-Copa-Alpine-Linux/">postmarketOS podcast #30</a> discusses how crossdirect works among lots of other things</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Pages_with_ignored_display_titles.html" title="Category:Pages with ignored display titles">Pages with ignored display titles</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.postmarketos.org/index.php?title=Pmbootstrap/Cross_Compiling&amp;oldid=64230">https://wiki.postmarketos.org/index.php?title=Pmbootstrap/Cross_Compiling&amp;oldid=64230</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 3 October 2024, at 14:03.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="../en/PostmarketOS:Privacy_policy.html">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/About_postmarketOS.html">About postmarketOS Wiki</a></li>
	<li id="footer-places-disclaimer"><a href="../en/PostmarketOS:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="../cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/"><img src="../poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="" width="88" height="31" loading="lazy"></a></li>
</ul>

</footer>

		</div>
	</div> 
</div> 

</body>
</html>
