<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Qualcomm S4/Krait 200 mainlining - postmarketOS Wiki</title>
<link rel="stylesheet" href="../PostmarketOSWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.1">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="postmarketOS Wiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.postmarketos.org/api.php?action=rsd">
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<link rel="alternate" type="application/atom+xml" title="postmarketOS Wiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Qualcomm_S4_Krait_200_mainlining rootpage-Qualcomm_S4_Krait_200_mainlining skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	<header class="vector-header mw-header">
		<div class="vector-header-start">
			<nav class="vector-main-menu-landmark" aria-label="Site">
				
<div id="vector-main-menu-dropdown" class="vector-dropdown vector-main-menu-dropdown vector-button-flush-left vector-button-flush-right">
	<input type="checkbox" id="vector-main-menu-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-main-menu-dropdown" class="vector-dropdown-checkbox " aria-label="Main menu">
	<label id="vector-main-menu-dropdown-label" for="vector-main-menu-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-menu mw-ui-icon-wikimedia-menu"></span>

<span class="vector-dropdown-label-text">Main menu</span>
	</label>
	<div class="vector-dropdown-content">


				<div id="vector-main-menu-unpinned-container" class="vector-unpinned-container">
		
<div id="vector-main-menu" class="vector-main-menu vector-pinnable-element">
	<div class="vector-pinnable-header vector-main-menu-pinnable-header vector-pinnable-header-unpinned" data-feature-name="main-menu-pinned" data-pinnable-element-id="vector-main-menu" data-pinned-container-id="vector-main-menu-pinned-container" data-unpinned-container-id="vector-main-menu-unpinned-container">
	<div class="vector-pinnable-header-label">Main menu</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-main-menu.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-main-menu.unpin">hide</button>
</div>

	
<div id="p-navigation" class="vector-menu mw-portlet mw-portlet-navigation">
	<div class="vector-menu-heading">
		Navigation
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-mainpage-description" class="mw-list-item"><a href="../en/Main_Page.html" title="Visit the main page [z]" accesskey="z"><span>Main page</span></a></li>
<li id="n-Devices" class="mw-list-item"><a href="../en/Devices.html"><span>Devices</span></a></li>
		</ul>
		
	</div>
</div>

	
	
</div>

				</div>

	</div>
</div>

		</nav>
			
<a href="../en/Main_Page.html" class="mw-logo">
	<img class="mw-logo-icon" src="/logo_50x50.svg" alt="" aria-hidden="true" height="50" width="50">
	<span class="mw-logo-container skin-invert">
		<strong class="mw-logo-wordmark">postmarketOS Wiki</strong>
	</span>
</a>

		</div>
		<div class="vector-header-end">
			
<div id="p-search" role="search" class="vector-search-box-vue  vector-search-box-collapses vector-search-box-show-thumbnail vector-search-box-auto-expand-width vector-search-box">
	<a href="../Special:Search.html" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only search-toggle" title="Search postmarketOS Wiki [f]" accesskey="f"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
	</a>
	<div class="vector-typeahead-search-container">
		<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail cdx-typeahead-search--auto-expand-width">
			<form action="/index.php" id="searchform" class="cdx-search-input cdx-search-input--has-end-button">
				<div id="simpleSearch" class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
					<div class="cdx-text-input cdx-text-input--has-start-icon">
						<input class="cdx-text-input__input" type="search" name="search" placeholder="Search postmarketOS Wiki" aria-label="Search postmarketOS Wiki" autocapitalize="sentences" title="Search postmarketOS Wiki [f]" accesskey="f" id="searchInput">
						<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
					</div>
					<input type="hidden" name="title" value="Special:Search">
				</div>
				<button class="cdx-button cdx-search-input__end-button">Search</button>
			</form>
		</div>
	</div>
</div>

			<nav class="vector-user-links vector-user-links-wide" aria-label="Personal tools">
	<div class="vector-user-links-main">
	
<div id="p-vector-user-menu-preferences" class="vector-menu mw-portlet emptyPortlet">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

	
<div id="p-vector-user-menu-userpage" class="vector-menu mw-portlet emptyPortlet">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

	<nav class="vector-appearance-landmark" aria-label="Appearance">
		
<div id="vector-appearance-dropdown" class="vector-dropdown " title="Change the appearance of the page's font size, width, and color">
	<input type="checkbox" id="vector-appearance-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-appearance-dropdown" class="vector-dropdown-checkbox " aria-label="Appearance">
	<label id="vector-appearance-dropdown-label" for="vector-appearance-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-appearance mw-ui-icon-wikimedia-appearance"></span>

<span class="vector-dropdown-label-text">Appearance</span>
	</label>
	<div class="vector-dropdown-content">


			<div id="vector-appearance-unpinned-container" class="vector-unpinned-container">
				
			</div>
		
	</div>
</div>

	</nav>
	
<div id="p-vector-user-menu-notifications" class="vector-menu mw-portlet emptyPortlet">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

	
<div id="p-vector-user-menu-overflow" class="vector-menu mw-portlet">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			<li id="pt-login-2" class="user-links-collapsible-item mw-list-item user-links-collapsible-item">
<a data-mw="interface" href="/index.php?title=Special:UserLogin&amp;returnto=Qualcomm+S4%2FKrait+200+mainlining" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o" class=""><span>Log in</span></a>
</li>
<li id="pt-createaccount-2" class="user-links-collapsible-item mw-list-item user-links-collapsible-item">
<a data-mw="interface" href="../Special:RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory" class=""><span>Request account</span></a>
</li>

			
		</ul>
		
	</div>
</div>

	</div>
	
<div id="vector-user-links-dropdown" class="vector-dropdown vector-user-menu vector-button-flush-right vector-user-menu-logged-out user-links-collapsible-item" title="More options">
	<input type="checkbox" id="vector-user-links-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-user-links-dropdown" class="vector-dropdown-checkbox " aria-label="Personal tools">
	<label id="vector-user-links-dropdown-label" for="vector-user-links-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-ellipsis mw-ui-icon-wikimedia-ellipsis"></span>

<span class="vector-dropdown-label-text">Personal tools</span>
	</label>
	<div class="vector-dropdown-content">


		
<div id="p-personal" class="vector-menu mw-portlet mw-portlet-personal user-links-collapsible-item" title="User menu">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="pt-login" class="user-links-collapsible-item mw-list-item"><a href="/index.php?title=Special:UserLogin&amp;returnto=Qualcomm+S4%2FKrait+200+mainlining" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span class="vector-icon mw-ui-icon-logIn mw-ui-icon-wikimedia-logIn"></span> <span>Log in</span></a></li>
<li id="pt-createaccount" class="user-links-collapsible-item mw-list-item"><a href="../Special:RequestAccount.html" title="You are encouraged to create an account and log in; however, it is not mandatory"><span>Request account</span></a></li>
		</ul>
		
	</div>
</div>

	
	</div>
</div>

</nav>

		</div>
	</header>
</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-sitenotice-container">
			<div id="siteNotice"></div>
		</div>
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Status" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Status">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Status</span>
			</div>
		</a>
		
		<ul id="toc-Status-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Overview" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Overview">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Overview</span>
			</div>
		</a>
		
			<button aria-controls="toc-Overview-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Overview subsection</span>
			</button>
		
		<ul id="toc-Overview-sublist" class="vector-toc-list">
			<li id="toc-APQ8064/MSM8960" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#APQ8064/MSM8960">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>APQ8064/MSM8960</span>
				</div>
			</a>
			
			<ul id="toc-APQ8064/MSM8960-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-MSM8227/MSM8930" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#MSM8227/MSM8930">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>MSM8227/MSM8930</span>
				</div>
			</a>
			
			<ul id="toc-MSM8227/MSM8930-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Getting_Started" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Getting_Started">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Getting Started</span>
			</div>
		</a>
		
			<button aria-controls="toc-Getting_Started-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Getting Started subsection</span>
			</button>
		
		<ul id="toc-Getting_Started-sublist" class="vector-toc-list">
			<li id="toc-Requirements" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Requirements">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Requirements</span>
				</div>
			</a>
			
			<ul id="toc-Requirements-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Before_you_start" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Before_you_start">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Before you start</span>
				</div>
			</a>
			
			<ul id="toc-Before_you_start-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Preparations" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Preparations">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Preparations</span>
				</div>
			</a>
			
			<ul id="toc-Preparations-sublist" class="vector-toc-list">
				<li id="toc-Board_type" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Board_type">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3.1</span>
					<span>Board type</span>
				</div>
			</a>
			
			<ul id="toc-Board_type-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-lk2nd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#lk2nd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>lk2nd</span>
				</div>
			</a>
			
			<ul id="toc-lk2nd-sublist" class="vector-toc-list">
				<li id="toc-Reserved_memory" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Reserved_memory">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4.1</span>
					<span>Reserved memory</span>
				</div>
			</a>
			
			<ul id="toc-Reserved_memory-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Initial_devicetree" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Initial_devicetree">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4.2</span>
					<span>Initial devicetree</span>
				</div>
			</a>
			
			<ul id="toc-Initial_devicetree-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Build_Kernel" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Build_Kernel">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.5</span>
					<span>Build Kernel</span>
				</div>
			</a>
			
			<ul id="toc-Build_Kernel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Initrd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Initrd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.6</span>
					<span>Initrd</span>
				</div>
			</a>
			
			<ul id="toc-Initrd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Booting_kernel" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Booting_kernel">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.7</span>
					<span>Booting kernel</span>
				</div>
			</a>
			
			<ul id="toc-Booting_kernel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Devicetree_setup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Devicetree_setup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.8</span>
					<span>Devicetree setup</span>
				</div>
			</a>
			
			<ul id="toc-Devicetree_setup-sublist" class="vector-toc-list">
				<li id="toc-Regulators" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Regulators">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.8.1</span>
					<span>Regulators</span>
				</div>
			</a>
			
			<ul id="toc-Regulators-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-USB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#USB">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.8.2</span>
					<span>USB</span>
				</div>
			</a>
			
			<ul id="toc-USB-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-eMMC" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#eMMC">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.8.3</span>
					<span>eMMC</span>
				</div>
			</a>
			
			<ul id="toc-eMMC-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GPIO_keys" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#GPIO_keys">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.8.4</span>
					<span>GPIO keys</span>
				</div>
			</a>
			
			<ul id="toc-GPIO_keys-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Device_doesn't_boot_after_small_change_in_device_tree_or_complains_about_bad_initrd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Device_doesn't_boot_after_small_change_in_device_tree_or_complains_about_bad_initrd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Device doesn't boot after small change in device tree or complains about bad initrd</span>
				</div>
			</a>
			
			<ul id="toc-Device_doesn't_boot_after_small_change_in_device_tree_or_complains_about_bad_initrd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Mainline_trees_and_configs" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Mainline_trees_and_configs">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Mainline trees and configs</span>
			</div>
		</a>
		
		<ul id="toc-Mainline_trees_and_configs-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Qualcomm S4/Krait 200 mainlining</span></h1>
				</header>
				<div class="vector-page-toolbar">
					<div class="vector-page-toolbar-container">
						<div id="left-navigation">
							<nav aria-label="Namespaces">
								
<div id="p-associated-pages" class="vector-menu vector-menu-tabs mw-portlet mw-portlet-associated-pages">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-nstab-main" class="selected vector-tab-noicon mw-list-item"><a href="../en/Qualcomm_S4_Krait_200_mainlining.html" title="View the content page [c]" accesskey="c"><span>Page</span></a></li>
<li id="ca-talk" class="new vector-tab-noicon mw-list-item"><a href="/index.php?title=Talk:Qualcomm_S4/Krait_200_mainlining&amp;action=edit&amp;redlink=1" rel="discussion" class="new" title="Discussion about the content page (page does not exist) [t]" accesskey="t"><span>Discussion</span></a></li>
		</ul>
		
	</div>
</div>

								
<div id="vector-variants-dropdown" class="vector-dropdown emptyPortlet">
	<input type="checkbox" id="vector-variants-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-variants-dropdown" class="vector-dropdown-checkbox " aria-label="Change language variant">
	<label id="vector-variants-dropdown-label" for="vector-variants-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet" aria-hidden="true"><span class="vector-dropdown-label-text">English</span>
	</label>
	<div class="vector-dropdown-content">


					
<div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</div>

				
	</div>
</div>

							</nav>
						</div>
						<div id="right-navigation" class="vector-collapsible">
							<nav aria-label="Views">
								
<div id="p-views" class="vector-menu vector-menu-tabs mw-portlet mw-portlet-views">
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-view" class="selected vector-tab-noicon mw-list-item"><a href="../en/Qualcomm_S4_Krait_200_mainlining.html"><span>Read</span></a></li>
<li id="ca-viewsource" class="vector-tab-noicon mw-list-item"><a href="/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e"><span>View source</span></a></li>
<li id="ca-history" class="vector-tab-noicon mw-list-item"><a href="/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
		</ul>
		
	</div>
</div>

							</nav>
				
							<nav class="vector-page-tools-landmark" aria-label="Page tools">
								
<div id="vector-page-tools-dropdown" class="vector-dropdown vector-page-tools-dropdown">
	<input type="checkbox" id="vector-page-tools-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-tools-dropdown" class="vector-dropdown-checkbox " aria-label="Tools">
	<label id="vector-page-tools-dropdown-label" for="vector-page-tools-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet" aria-hidden="true"><span class="vector-dropdown-label-text">Tools</span>
	</label>
	<div class="vector-dropdown-content">


									<div id="vector-page-tools-unpinned-container" class="vector-unpinned-container">
						
<div id="vector-page-tools" class="vector-page-tools vector-pinnable-element">
	<div class="vector-pinnable-header vector-page-tools-pinnable-header vector-pinnable-header-unpinned" data-feature-name="page-tools-pinned" data-pinnable-element-id="vector-page-tools" data-pinned-container-id="vector-page-tools-pinned-container" data-unpinned-container-id="vector-page-tools-unpinned-container">
	<div class="vector-pinnable-header-label">Tools</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-page-tools.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-page-tools.unpin">hide</button>
</div>

	
<div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions vector-has-collapsible-items" title="More options">
	<div class="vector-menu-heading">
		Actions
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="../en/Qualcomm_S4_Krait_200_mainlining.html"><span>Read</span></a></li>
<li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;action=edit"><span>View source</span></a></li>
<li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;action=history"><span>View history</span></a></li>
<li id="ca-cargo-purge" class="mw-list-item"><a href="/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;action=purge"><span>Purge cache</span></a></li>
		</ul>
		
	</div>
</div>

<div id="p-tb" class="vector-menu mw-portlet mw-portlet-tb">
	<div class="vector-menu-heading">
		General
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="t-whatlinkshere" class="mw-list-item"><a href="../Special:WhatLinksHere_Qualcomm_S4_Krait_200_mainlining.html" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li>
<li id="t-recentchangeslinked" class="mw-list-item"><a href="../Special:RecentChangesLinked_Qualcomm_S4_Krait_200_mainlining.html" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li>
<li id="t-specialpages" class="mw-list-item"><a href="../Special:SpecialPages.html" title="A list of all special pages [q]" accesskey="q"><span>Special pages</span></a></li>
<li id="t-print" class="mw-list-item"><a href="javascript:print();" rel="alternate" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li>
<li id="t-permalink" class="mw-list-item"><a href="/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;oldid=75909" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li>
<li id="t-info" class="mw-list-item"><a href="/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;action=info" title="More information about this page"><span>Page information</span></a></li>
<li id="t-cargopagevalueslink" class="mw-list-item"><a href="/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;action=pagevalues" rel="cargo-pagevalues"><span>Cargo data</span></a></li>
		</ul>
		
	</div>
</div>

<div id="p-The_usual_wiki_links" class="vector-menu mw-portlet mw-portlet-The_usual_wiki_links">
	<div class="vector-menu-heading">
		The usual wiki links
	</div>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-Editor's-Guide" class="mw-list-item"><a href="../en/Help:Wiki_editor's_guide.html"><span>Editor's Guide</span></a></li>
<li id="n-recentchanges" class="mw-list-item"><a href="../Special:RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r"><span>Recent changes</span></a></li>
<li id="n-randompage" class="mw-list-item"><a href="../Special:Random.html" title="Load a random page [x]" accesskey="x"><span>Random page</span></a></li>
<li id="n-Templates" class="mw-list-item"><a href="../en/PostmarketOS:Templates.html"><span>Templates</span></a></li>
		</ul>
		
	</div>
</div>

</div>

									</div>
				
	</div>
</div>

							</nav>
						</div>
					</div>
				</div>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From postmarketOS Wiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p>This page covers the <a rel="nofollow" class="external text" href="https://wiki.postmarketos.org/wiki/Qualcomm_Snapdragon_S4_Plus_(MSM8960)">Qualcomm MSM8960/APQ8064 (Snapdragon S4 series)</a> — a high-end smartphone SoC and the <a rel="nofollow" class="external text" href="https://wiki.postmarketos.org/wiki/Qualcomm_Snapdragon_S4_Plus/400_(MSM8227/MSM8930)">Qualcomm MSM8227 with its' siblings</a> — a mid-range SoCs from 2012.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Status">Status</span></h2>
<p>The following features, which are provided by the SoC, are supported in the mainline and should work on most devices once the device tree has been set up:
</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter" class="extiw" title="wikipedia:Universal asynchronous receiver-transmitter">UART</a></li>
<li>USB</li>
<li>Internal/External Storage (<a href="https://en.wikipedia.org/wiki/MultiMediaCard#eMMC" class="extiw" title="wikipedia:MultiMediaCard">eMMC</a>/<a href="https://en.wikipedia.org/wiki/SD_card" class="extiw" title="wikipedia:SD card">SD card</a>) (SD card may or may not work depending on device)</li>
<li>Power, volume up/down buttons</li>
</ul>
<p>Certain components (e.g. touchscreen, sensors, ...) are device-specific. With a bit of luck, some will be already supported by mainline, others won't.
</p>
<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<h3>
<span id="APQ8064.2FMSM8960"></span><span class="mw-headline" id="APQ8064/MSM8960"><a rel="nofollow" class="external text" href="https://gitlab.postmarketos.org/LogicalErzor/apq8064-mainline">APQ8064/MSM8960</a></span>
</h3>
<p>Currently, most of the work is done directly in the mainline Linux. We have an external tree that holds patches submitted to LKML, allowing others to share progress in one place. Please do not submit patches to this repository unless they have been submitted to LKML, notify <a href="../User:LogicalErzor.html" title="User:LogicalErzor">LogicalErzor</a> of the LKML ID to include it in this repository.
</p>
<h3>
<span id="MSM8227.2FMSM8930"></span><span class="mw-headline" id="MSM8227/MSM8930"><a rel="nofollow" class="external text" href="https://github.com/msm8227-mainline/linux">MSM8227/MSM8930</a></span>
</h3>
<p>WIP kernel which consists of <a rel="nofollow" class="external text" href="https://gitlab.postmarketos.org/LogicalErzor/apq8064-mainline">APQ8064</a>, <a rel="nofollow" class="external text" href="https://github.com/flto/linux">flto's</a> and <a rel="nofollow" class="external text" href="https://github.com/konradybcio/linux-nicki">Konrad's</a> work.
</p>
<h2><span class="mw-headline" id="Getting_Started">Getting Started</span></h2>
<h3><span class="mw-headline" id="Requirements">Requirements</span></h3>
<ul>
<li>S4 family-based device</li>
<li>UART (for minimal kernel, once the USB works it's not required)</li>
<li>(Downstream) Linux kernel source for your device provided by vendor</li>
<li>Basic knowledge about Linux, Git, C, Device Trees, ...</li>
<li>Willingness to learn about "mainlining" and to figure out things on your own. Please see <a href="../en/Mainlining_Guide.html" title="Mainlining Guide">Mainlining Guide</a>
</li>
</ul>
<h3><span class="mw-headline" id="Before_you_start">Before you start</span></h3>
<table role="text container" class="box-note" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Note"><img alt="Note" src="../Reference_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>Warning:</b> Mainlining (or any unintended "modding") may brick your device permanently if you make a mistake. There is a good chance that nothing happens if you are a bit careful, but do not continue with a device that you need every day. You have been warned!</td>
</tr></tbody></table>
<p>Mainlining is not easy. S4 is a platform where a lot components can be easily enabled by only setting up a device tree, which can be largely copied from other devices with minor changes. However, at some point you will reach the point where you would like to enable a particular component that is device-specific (e.g. the touchscreen, sensors, ...). In this case you will be largely on your own, and need to figure out how to enable it yourself. (Do you just need to add something to the device tree or even write a new kernel driver?) That requires some familiarity with the way the Linux kernel is working for S4 family.
</p>
<p>If you have any questions, ask @wctrl:matrix.org about MSM8227/MSM8930.
</p>
<p>Please also join the APQ8064/MSM8960 specific channel on <a rel="nofollow" class="external text" href="https://matrix.to/#/#linux-apq8064:matrix.org">Matrix</a>.
</p>
<h3><span class="mw-headline" id="Preparations">Preparations</span></h3>
<h4><span class="mw-headline" id="Board_type">Board type</span></h4>
<p>To prevent issues in the future, you need to know the type of board, run <code>dmesg | grep Machine</code> on downstream kernel. When adding device tree nodes, don't forget to look in the <code>_devices</code> array, prefixed with board type
</p>
<table role="text container" class="box-note" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Note"><img alt="Note" src="../Reference_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>Warning:</b> Downstream may refer to MSM8960 devices in board files for MSM8930, be careful when taking values from other SoC (although MSM8960 is quite similar to MSM8930/MSM8227, so some values are the same)</td>
</tr></tbody></table>
<h3><span class="mw-headline" id="lk2nd">lk2nd</span></h3>
<table role="text container" class="box-warning" style="color: inherit; background-color: #fee7e6; border: 1px solid #d33; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Warning"><img alt="Warning" src="../Red_warning_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>WARNING:</b> lk2nd has issue on MSM8227/MSM8930 with boot.img larger than 20MB</td>
</tr></tbody></table>
<table role="text container" class="box-note" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Note"><img alt="Note" src="../Reference_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>Note:</b> lk2nd is not strictly required to boot mainline. However, certain features (e.g. WiFi, BT, secondary CPU cores, ...) only work with some additional mainline quirks included in lk2nd. In the future, there may be more features that depend on extra code that needs to be run in the bootloader. Therefore, lk2nd is recommended for all devices, even if your stock bootloader already provides a standard Fastboot interface.</td>
</tr></tbody></table>
<p><a rel="nofollow" class="external text" href="https://github.com/msm8916-mainline/lk2nd">lk2nd</a> does not require any device-specific code. Normally, it should just run out of the box on your device.
</p>
<p>Grab the latest release (20.0 or higher is required) and flash. Buttons won't work, but just simply add that (look at commit history to see how others have done it).
</p>
<h4><span class="mw-headline" id="Reserved_memory">Reserved memory</span></h4>
<p>Since some things (such as TrustZone) allocate some memory to themselves and can cause unexplained problems during the bool process, it is highly recommended to add reserved memory.
</p>
<p>To figure out what your reserved memories are, first install lk2nd onto your device and then run <code>fastboot oem parsed-tags &amp;&amp; fastboot get_staged atags.bin</code>. You should now have a file called atags.bin
</p>
<p>Next, make a file called <code>atags.c</code> in <code>path/to/linux/arch/arm/include/uapi/asm/</code> and put the following code inside
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"setup.h"</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">parse_tag</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tag</span><span class="w"> </span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">hdr</span><span class="p">.</span><span class="n">tag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ATAG_MEM</span><span class="p">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"Mem: 0x%x - 0x%x (size %d)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ATAG_INITRD2</span><span class="p">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"Initrd: 0x%x - 0x%x (size: %d)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">initrd</span><span class="p">.</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">initrd</span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">initrd</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">initrd</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ATAG_SERIAL</span><span class="p">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"Serial: %08x%08x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">serialnr</span><span class="p">.</span><span class="n">high</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">serialnr</span><span class="p">.</span><span class="n">low</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ATAG_REVISION</span><span class="p">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"Revision: 0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">revision</span><span class="p">.</span><span class="n">rev</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ATAG_CMDLINE</span><span class="p">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"Cmdline: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cmdline</span><span class="p">.</span><span class="n">cmdline</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ATAG_CORE</span><span class="p">:</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ATAG_NONE</span><span class="p">:</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// Ignore</span>
<span class="w">        </span><span class="k">default</span><span class="o">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"Unknown: 0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">hdr</span><span class="p">.</span><span class="n">tag</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="s">"rb"</span><span class="p">);</span>
<span class="w">    </span><span class="n">fseek</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_END</span><span class="p">);</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">fsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ftell</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="w">    </span><span class="n">fseek</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="p">);</span>

<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tag</span><span class="w"> </span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">fsize</span><span class="p">);</span>
<span class="w">    </span><span class="n">fread</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">fsize</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">);</span>
<span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">hdr</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ATAG_CORE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">"Fail: 0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">hdr</span><span class="p">.</span><span class="n">tag</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">t</span><span class="o">-&gt;</span><span class="n">hdr</span><span class="p">.</span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tag_next</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">parse_tag</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>Compile that c file with <code>cc atags.c -o atags</code> and run <code>./atags atags.bin</code>. It should give you something like the following:
</p>
<pre>Revision: 0x8
Serial: 0000b1c10000f58e
Mem: 0x80200000 - 0x88d00000 (size 145752064)
Mem: 0x90000000 - 0xc0000000 (size 805306368)
Cmdline: lk2nd ...
</pre>
<h4><span class="mw-headline" id="Initial_devicetree">Initial devicetree</span></h4>
<p>Unfortunately, as the S4 platform is outdated, many of the downstream kernels use board files instead of device trees. That means you will likely have to manually traverse these board files to make a proper device tree.
</p>
<p>Let's add <code>qcom-msm*soc*-*vendor*-*codename*.dts</code> to <code>arch/arm/boot/dts/qcom</code> with UART node:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-2.0-only</span>

<span class="c1">// For MSM8227/8930:</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"qcom-msm8930.dtsi"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"pm8038.dtsi"</span>

<span class="c1">// For MSM8960:</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"qcom-msm8960.dtsi"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"pm8921.dtsi"</span>

<span class="c1">// For APQ8064:</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"qcom-apq8064.dtsi"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"pm8821.dtsi"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"pm8921.dtsi"</span>

<span class="o">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Model"</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>

<span class="w">    </span><span class="c1">// add "qcom,apq8064" at the end for the APQ8064,</span>
<span class="w">    </span><span class="c1">// "qcom,msm8960" for MSM8960,</span>
<span class="w">    </span><span class="c1">// "qcom,msm8930" for MSM8930</span>
<span class="w">    </span><span class="c1">// "qcom,msm8930", "qcom,msm8227" for MSM8227</span>
<span class="w">	</span><span class="n">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"vendor,codename"</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>

<span class="w">	</span><span class="n">aliases</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">serial0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gsbi5_serial</span><span class="p">;</span>
<span class="w">	</span><span class="p">};</span>

<span class="w">	</span><span class="n">chosen</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">stdout</span><span class="o">-</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"serial0:115200n8"</span><span class="p">;</span>
<span class="w">	</span><span class="p">};</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="n">gsbi5</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">qcom</span><span class="p">,</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">GSBI_PROT_I2C_UART</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">	</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"okay"</span><span class="p">;</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="n">gsbi5_serial</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"okay"</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<table role="text container" class="box-note" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Note"><img alt="Note" src="../Reference_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">Don't forget to remove unnecessary include directives</td>
</tr></tbody></table>
<p>Now add <code>qcom-msm*soc*-*vendor*-*codename*.dtb</code> to <code>arch/arm/boot/dts/qcom/Makefile</code> in alphabetical order.
</p>
<table role="text container" class="box-warning" style="color: inherit; background-color: #fee7e6; border: 1px solid #d33; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Warning"><img alt="Warning" src="../Red_warning_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>WARNING:</b> If your board based on EVT, the GSBI8 should be used for UART instead</td>
</tr></tbody></table>
<p>The devicetree should look like this:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-2.0-only</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"qcom-msm8930.dtsi"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"pm8038.dtsi"</span>

<span class="o">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Sony Xperia M"</span><span class="p">;</span>
<span class="w">	</span><span class="n">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sony,nicki"</span><span class="p">,</span><span class="w"> </span><span class="s">"qcom,msm8930"</span><span class="p">,</span><span class="w"> </span><span class="s">"qcom,msm8227"</span><span class="p">;</span>

<span class="w">	</span><span class="n">aliases</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">serial0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gsbi5_serial</span><span class="p">;</span>
<span class="w">	</span><span class="p">};</span>

<span class="w">	</span><span class="n">chosen</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">stdout</span><span class="o">-</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"serial0:115200n8"</span><span class="p">;</span>
<span class="w">	</span><span class="p">};</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="n">gsbi5</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">qcom</span><span class="p">,</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">GSBI_PROT_I2C_UART</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">	</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"okay"</span><span class="p">;</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="n">gsbi5_serial</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"okay"</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<h3><span class="mw-headline" id="Build_Kernel">Build Kernel</span></h3>
<p>Go back to your kernel tree. Try to build it with <a href="../en/Compiling_kernels_with_envkernel.sh.html" title="Compiling kernels with envkernel.sh">envkernel.sh</a>:
</p>
<pre>$ cd path/to/kernel
$ source path/to/pmbootstrap/helpers/envkernel.sh

# Initialize kernel configuration:
# qcom_msm8227_defconfig for MSM8227/MSM8930,
# qcom_apq8064_defconfig for APQ8064/MSM8960
# Replace &lt;cores&gt; with the number of cores you'd like to use for compilation
$ make &lt;defconfig&gt; -j&lt;cores&gt;

# Compile kernel
$ make -j&lt;cores&gt;
</pre>
<p>For APQ8064/MSM8960 you can build device package instead (only if downstream could boot pmos, bad for quick local development): <code>pmbootstrap build --envkernel linux-next</code>
</p>
<p>Otherwise, you can build with LLVM (e.g. using <a rel="nofollow" class="external text" href="https://www.kernel.org/pub/tools/llvm/">toolchain with PGO</a>, which should be faster than gcc):
</p>
<pre>$ make ARCH=arm LLVM=1 &lt;defconfig&gt; -j&lt;cores&gt;
$ make ARCH=arm LLVM=1 -j&lt;cores&gt;
</pre>
<p>After the device tree has been set up, you may want fast incremental builds, install <code>ccache</code> and append <code>CC="ccache clang"</code>
</p>
<h3><span class="mw-headline" id="Initrd">Initrd</span></h3>
<p>The initramfs generated by pmbootstrap is not suitable for debugging. You can of course just use busybox, but to include more utilities like <code>irqtop</code> it would be better to use a builder like <a rel="nofollow" class="external text" href="https://buildroot.org">buildroot</a>. You can use <a rel="nofollow" class="external text" href="https://gist.github.com/wctrl/dd1bbcad2863ed3022b7b0b8d6837f7b">my config</a> or make your own, it should work with both mainline and downstream kernels.
</p>
<h3><span class="mw-headline" id="Booting_kernel">Booting kernel</span></h3>
<p>Chances are you'd like to test the changes faster, so you need to build the <a rel="nofollow" class="external text" href="https://wiki.postmarketos.org/wiki/Glossary#boot.img">boot.img</a> yourself rather updating package. Since the kernel needs the device tree to work properly, you need to append it to the kernel, and package it into android boot image with your device parameters (you can get them from the device package, <a rel="nofollow" class="external text" href="https://gitlab.postmarketos.org/postmarketOS/pmaports/-/commit/805cf7bb625a41c28411424175cd4c7a5afe3b44">example</a>). So your loop will boil down to:
</p>
<pre>$ make ...
$ cat arch/arm/boot/zImage arch/arm/boot/dts/qcom/YOUR-DT-HERE.dtb &gt; kernel.bin
# This may be different for your device
$ mkbootimg -o boot.img --pagesize 4096 --base 0x80200000 --kernel_offset 0x00008000 --ramdisk_offset 0x02000000 --second_offset 0x00f00000 --tags_offset 0x00000100 --kernel kernel.bin --ramdisk /path/to/initrd --cmdline "console=ttyMSM0,115200,n8 earlycon"
# On the device after you test stuff
$ reboot
</pre>
<p>When you want to boot the downstream, take cmdline from device package or use <code>console=ttyHSL0,115200</code>.
</p>
<table role="text container" class="box-note" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Note"><img alt="Note" src="../Reference_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">The downstream kernel uses <code>ttyHSL0</code> for console, however this is wrong on mainline, don't repeat my mistakes and use <code>ttyMSM0</code>
</td>
</tr></tbody></table>
<h3><span class="mw-headline" id="Devicetree_setup">Devicetree setup</span></h3>
<h4><span class="mw-headline" id="Regulators">Regulators</span></h4>
<table role="text container" class="box-warning" style="color: inherit; background-color: #fee7e6; border: 1px solid #d33; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Warning"><img alt="Warning" src="../Red_warning_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>WARNING:</b> Hardware components usually only work correctly within a limited voltage range. Exceeding the specified voltage range for a component may cause it to malfunction, or even break physically. Please go through this section carefully</td>
</tr></tbody></table>
<p>Before you add something else, you need the regulators. Usually you'd like to look for:
</p>
<ul>
<li>
<code>arch/arm/mach-msm/board-8930-regulator-pm8038.c</code> - for MSM8227</li>
<li>
<code>arch/arm/mach-msm/board-8930-regulator-pm8917.c</code> - for MSM8930</li>
<li>
<code>arch/arm/mach-msm/board-8960-regulator</code> - for MSM8960</li>
<li>
<code>arch/arm/mach-msm/board-8064-regulator</code> - for APQ8064</li>
</ul>
<p><br>
</p>
<table role="text container" class="box-warning" style="color: inherit; background-color: #fee7e6; border: 1px solid #d33; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Warning"><img alt="Warning" src="../Red_warning_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>WARNING:</b> Please verify that you have PM8038 with MSM8227, PM8917 with MSM8930 and PM8921 with MSM8960/APQ8064</td>
</tr></tbody></table>
<table role="text container" class="box-warning" style="color: inherit; background-color: #fee7e6; border: 1px solid #d33; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Warning"><img alt="Warning" src="../Red_warning_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>WARNING:</b> MSM8930 ships with PM8038 or PM8917 PMIC, but only the PM8038 is supported now</td>
</tr></tbody></table>
<p>Find something similar to <code>RPM_SMPS(S1, 0, 1, 1, 500000, 1150000, NULL, 100000, 4p80, AUTO, LPM)</code> and copy values like in this example:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&amp;</span><span class="n">rpm</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">regulators</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"qcom,rpm-pm8038-regulators"</span><span class="p">;</span>
<span class="w">		</span>
<span class="w">		</span><span class="cm">/* SMPS */</span>
<span class="w">		</span><span class="nl">pm8038_s1</span><span class="p">:</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">regulator</span><span class="o">-</span><span class="n">always</span><span class="o">-</span><span class="n">on</span><span class="p">;</span>
<span class="w">			</span><span class="n">regulator</span><span class="o">-</span><span class="n">min</span><span class="o">-</span><span class="n">microvolt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">500000</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">			</span><span class="n">regulator</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">microvolt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1150000</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">			</span><span class="n">qcom</span><span class="p">,</span><span class="k">switch</span><span class="o">-</span><span class="n">mode</span><span class="o">-</span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">4800000</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">		</span><span class="p">};</span>
<span class="w">		</span><span class="c1">// s2, s3, ..., l1, l2, ..., lvs1, lvs2, ...</span>
<span class="w">	</span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
<table role="text container" class="box-note" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Note"><img alt="Note" src="../Reference_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>Note:</b> You don't need to add <code>S5</code> and <code>S6</code>, they're defined in SoC tree. You may also notice that some regulators use other regulators for power supply. Use existing dts as an example.</td>
</tr></tbody></table>
<h4><span class="mw-headline" id="USB">USB</span></h4>
<p>Usually you won't find a regulator with an exact voltage of 3.3V, instead you should use 3.075V. In most cases, all you need to do is set the supply regulators and select USB OTG mode:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&amp;</span><span class="n">usb_hs1_phy</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">v3p3</span><span class="o">-</span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_l3</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">	</span><span class="n">v1p8</span><span class="o">-</span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_l4</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="n">usb1</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">dr_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"otg"</span><span class="p">;</span>
<span class="w">	</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"okay"</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<table role="text container" class="box-note" style="color: inherit; background-color: #f6efe5; border: 1px solid #ac6600; margin: 4px 0; border-collapse: collapse;"><tbody><tr>
<td style="padding: 2px 0 2px 0.9em; text-align: center; line-height: 1;"><span style="white-space: nowrap;"><span typeof="mw:File"><span title="Note"><img alt="Note" src="../Reference_icon.svg" decoding="async" width="20" height="20" class="mw-file-element"></span></span></span></td>
<td style="padding: 0.35em 0.9em; width: 100%;">
<b>Note:</b> You can check the USB connection by looking at your PC's <code>dmesg</code>
</td>
</tr></tbody></table>
<h4><span class="mw-headline" id="eMMC">eMMC</span></h4>
<p>Adding regulators is enough:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&amp;</span><span class="n">sdcc1</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">vmmc</span><span class="o">-</span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_l5</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME: change for your device</span>
<span class="w">	</span><span class="n">vqmmc</span><span class="o">-</span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_l11</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME: change for your device</span>

<span class="w">	</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"okay"</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p>However, pinctrl is recommended. Open <code>board-8930-storage.c</code> and find the pad data structures. They're quite simple, so the device tree equivalent should look like this:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&amp;</span><span class="n">msmgpio</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="nl">sdcc1_pins_active</span><span class="p">:</span><span class="w"> </span><span class="n">sdcc1</span><span class="o">-</span><span class="n">pins</span><span class="o">-</span><span class="n">active</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">clk</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">pins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sdc1_clk"</span><span class="p">;</span>
<span class="w">			</span><span class="n">drive</span><span class="o">-</span><span class="n">strengh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">			</span><span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="p">;</span>
<span class="w">		</span><span class="p">};</span>

<span class="w">		</span><span class="n">cmd</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">pins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sdc1_cmd"</span><span class="p">;</span>
<span class="w">			</span><span class="n">drive</span><span class="o">-</span><span class="n">strengh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">			</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="p">;</span>
<span class="w">		</span><span class="p">};</span>

<span class="w">		</span><span class="n">data</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">pins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sdc1_data"</span><span class="p">;</span>
<span class="w">			</span><span class="n">drive</span><span class="o">-</span><span class="n">strengh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">			</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="p">;</span>
<span class="w">		</span><span class="p">};</span>
<span class="w">	</span><span class="p">};</span>

<span class="w">	</span><span class="nl">sdcc1_pins_sleep</span><span class="p">:</span><span class="w"> </span><span class="n">sdcc1</span><span class="o">-</span><span class="n">pins</span><span class="o">-</span><span class="n">sleep</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">clk</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">pins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sdc1_clk"</span><span class="p">;</span>
<span class="w">			</span><span class="n">drive</span><span class="o">-</span><span class="n">strengh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">			</span><span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="p">;</span>
<span class="w">		</span><span class="p">};</span>

<span class="w">		</span><span class="n">cmd</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">pins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sdc1_cmd"</span><span class="p">;</span>
<span class="w">			</span><span class="n">drive</span><span class="o">-</span><span class="n">strengh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">			</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="p">;</span>
<span class="w">		</span><span class="p">};</span>

<span class="w">		</span><span class="n">data</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">pins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sdc1_data"</span><span class="p">;</span>
<span class="w">			</span><span class="n">drive</span><span class="o">-</span><span class="n">strengh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">			</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="p">;</span>
<span class="w">		</span><span class="p">};</span>
<span class="w">	</span><span class="p">};</span>
<span class="p">};</span>

<span class="o">&amp;</span><span class="n">sdcc1</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">vmmc</span><span class="o">-</span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_l5</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>
<span class="w">	</span><span class="n">vqmmc</span><span class="o">-</span><span class="n">supply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_l11</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>

<span class="w">	</span><span class="n">pinctrl</span><span class="mi">-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">sdcc1_pins_active</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">	</span><span class="n">pinctrl</span><span class="mi">-1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">sdcc1_pins_sleep</span><span class="o">&gt;</span>
<span class="w">	</span><span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"default"</span><span class="p">,</span><span class="w"> </span><span class="s">"sleep"</span><span class="p">;</span>

<span class="w">	</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"okay"</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<h4><span class="mw-headline" id="GPIO_keys">GPIO keys</span></h4>
<p>Look for <code>keys_8930_pm8038</code> in <code>board-8930.c</code>. Add following skeleton to your root node and change values:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="n">gpio</span><span class="o">-</span><span class="n">keys</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">compatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"gpio-keys"</span><span class="p">;</span>

<span class="w">        </span><span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"default"</span><span class="p">;</span>
<span class="w">        </span><span class="n">pinctrl</span><span class="mi">-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">gpio_keys_pin_a</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// defined in pm8038.dtsi</span>

<span class="w">        </span><span class="n">key</span><span class="o">-</span><span class="n">camera</span><span class="o">-</span><span class="n">focus</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"camera_focus"</span><span class="p">;</span>
<span class="w">            </span><span class="n">gpios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_gpio</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">GPIO_ACTIVE_LOW</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>
<span class="w">            </span><span class="n">linux</span><span class="p">,</span><span class="n">input</span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">            </span><span class="n">linux</span><span class="p">,</span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">KEY_CAMERA_FOCUS</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="n">key</span><span class="o">-</span><span class="n">camera</span><span class="o">-</span><span class="n">snapshot</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"camera_snapshot"</span><span class="p">;</span>
<span class="w">            </span><span class="n">gpios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_gpio</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">GPIO_ACTIVE_LOW</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>
<span class="w">            </span><span class="n">linux</span><span class="p">,</span><span class="n">input</span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">            </span><span class="n">linux</span><span class="p">,</span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">KEY_CAMERA</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="n">key</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">down</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"volume_down"</span><span class="p">;</span>
<span class="w">            </span><span class="n">gpios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_gpio</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">GPIO_ACTIVE_LOW</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>
<span class="w">            </span><span class="n">linux</span><span class="p">,</span><span class="n">input</span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">            </span><span class="n">linux</span><span class="p">,</span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">KEY_VOLUMEDOWN</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="n">key</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">up</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"volume_up"</span><span class="p">;</span>
<span class="w">            </span><span class="n">gpios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&amp;</span><span class="n">pm8038_gpio</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">GPIO_ACTIVE_LOW</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>
<span class="w">            </span><span class="n">linux</span><span class="p">,</span><span class="n">input</span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">            </span><span class="n">linux</span><span class="p">,</span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">KEY_VOLUMEUP</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">		</span><span class="p">};</span>
<span class="w">    </span><span class="p">};</span>
</pre></div>
<p>The power button should work without any configuration.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id="Device_doesn.27t_boot_after_small_change_in_device_tree_or_complains_about_bad_initrd"></span><span class="mw-headline" id="Device_doesn't_boot_after_small_change_in_device_tree_or_complains_about_bad_initrd">Device doesn't boot after small change in device tree or complains about bad initrd</span>
</h3>
<p>This is probably due to incorrect memory ranges. Currently, we don't rely on lk2nd that much, so you can try booting from original bootloader (if possible), kernel should apply atags information and fix it. Otherwise <a href="../en/Qualcomm_S4_Krait_200_mainlining.html" class="mw-redirect" title="MSM8960 Mainlining">parse atags to determine memory ranges</a> and add memory node to the root node:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="n">memory</span><span class="err">@</span><span class="mi">80000000</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">device_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"memory"</span><span class="p">;</span>
<span class="w">	</span><span class="n">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x80200000</span><span class="w"> </span><span class="mh">0x8c00000</span><span class="w"> </span><span class="mh">0x90000000</span><span class="w"> </span><span class="mh">0x10000000</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// FIXME</span>
<span class="p">};</span>
</pre></div>
<p>The above example is equivalent to:
</p>
<pre>Mem: 0x80200000 - 0x88e00000 (size 146800640)
Mem: 0x90000000 - 0xa0000000 (size 268435456)
</pre>
<p>Remember to apply <a rel="nofollow" class="external text" href="https://github.com/wctrl/lk2nd/commit/ffda1d8e0689fd1f2785aa8edab95fb82fa160b3">lk2nd hack</a> or the bootloader will override the values.
</p>
<h2><span class="mw-headline" id="Mainline_trees_and_configs">Mainline trees and configs</span></h2>
<p>May help with certain devices
</p>
<ul>
<li>
<a rel="nofollow" class="external free" href="https://github.com/apq8064-mainline/linux">https://github.com/apq8064-mainline/linux</a> (outdated, please migrate to LogicalErzor's tree)
<ul><li><a rel="nofollow" class="external free" href="https://github.com/apq8064-mainline/linux/blob/qcom-apq8064-next/arch/arm/configs/qcom_apq8064_defconfig">https://github.com/apq8064-mainline/linux/blob/qcom-apq8064-next/arch/arm/configs/qcom_apq8064_defconfig</a></li></ul>
</li>
<li>
<a rel="nofollow" class="external free" href="https://github.com/msm8227-mainline/linux">https://github.com/msm8227-mainline/linux</a>
<ul><li><a rel="nofollow" class="external free" href="https://github.com/msm8227-mainline/linux/blob/msm8227-6.14/arch/arm/configs/qcom_msm8227_defconfig">https://github.com/msm8227-mainline/linux/blob/msm8227-6.14/arch/arm/configs/qcom_msm8227_defconfig</a></li></ul>
</li>
<li>
<a rel="nofollow" class="external free" href="https://codeberg.org/LogicalErzor/linux/src/branch/expressatt">https://codeberg.org/LogicalErzor/linux/src/branch/expressatt</a>
<ul>
<li><a rel="nofollow" class="external free" href="https://gitlab.postmarketos.org/postmarketOS/pmaports/-/blob/master/device/testing/linux-next/devices.config">https://gitlab.postmarketos.org/postmarketOS/pmaports/-/blob/master/device/testing/linux-next/devices.config</a></li>
<li><a rel="nofollow" class="external free" href="https://gitlab.postmarketos.org/postmarketOS/pmaports/-/blob/master/device/testing/linux-next/pmos.config">https://gitlab.postmarketos.org/postmarketOS/pmaports/-/blob/master/device/testing/linux-next/pmos.config</a></li>
</ul>
</li>
<li><a rel="nofollow" class="external free" href="https://github.com/peremen/linux-apq8064-mainline/commits/qcom-apq8064-next/">https://github.com/peremen/linux-apq8064-mainline/commits/qcom-apq8064-next/</a></li>
<li>
<a rel="nofollow" class="external free" href="https://github.com/Tofee/shr-linux/commits/tenderloin/6.13/mainline-for-upstream">https://github.com/Tofee/shr-linux/commits/tenderloin/6.13/mainline-for-upstream</a> (scorpion?)</li>
<li>
<a rel="nofollow" class="external free" href="https://github.com/andersson/kernel/blob/41e99cea7c35e82d74862b0293a24a1930c322c4/arch/arm/boot/dts/sony-blue-mint.dts">https://github.com/andersson/kernel/blob/41e99cea7c35e82d74862b0293a24a1930c322c4/arch/arm/boot/dts/sony-blue-mint.dts</a> (beware, very old, 2015)</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Guide.html" title="Category:Guide">Guide</a></li>
<li><a href="../en/Category:Technical_Reference.html" title="Category:Technical Reference">Technical Reference</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.postmarketos.org/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;oldid=75909">https://wiki.postmarketos.org/index.php?title=Qualcomm_S4/Krait_200_mainlining&amp;oldid=75909</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 21 May 2025, at 07:25.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="../en/PostmarketOS:Privacy_policy.html">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/About_postmarketOS.html">About postmarketOS Wiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/PostmarketOS:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="../cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="../poweredby_mediawiki.svg" alt="Powered by MediaWiki" width="88" height="31" loading="lazy"></a></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
